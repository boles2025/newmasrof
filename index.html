<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <title>üí∞ ÿ•ÿØÿßÿ±ÿ© ÿßŸÑŸÖÿµÿ±ŸàŸÅÿßÿ™ ÿßŸÑÿ∞ŸÉŸäÿ©</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;500;600;700;800;900&family=Tajawal:wght@300;400;500;700;800&display=swap" rel="stylesheet">
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database-compat.js"></script>
    <style>
        :root {
            /* ŸÜÿ∏ÿßŸÖ ÿ£ŸÑŸàÿßŸÜ ÿßÿ≠ÿ™ÿ±ÿßŸÅŸä - ÿ™ÿµŸÖŸäŸÖ ÿØÿßŸÉŸÜ */
            --primary: #6366f1;
            --primary-light: #818cf8;
            --primary-dark: #4f46e5;
            --secondary: #10b981;
            --secondary-light: #34d399;
            --secondary-dark: #059669;
            --accent: #f59e0b;
            --danger: #ef4444;
            --warning: #f59e0b;
            --success: #10b981;
            --info: #3b82f6;
            
            --dark-bg: #0f172a;
            --dark-surface: #1e293b;
            --dark-surface-light: #334155;
            --dark-border: #475569;
            --dark-text: #f1f5f9;
            --dark-text-secondary: #94a3b8;
            --dark-text-muted: #64748b;
            
            --glass-bg: rgba(255, 255, 255, 0.05);
            --glass-border: rgba(255, 255, 255, 0.1);
            --glass-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
            
            --radius-sm: 10px;
            --radius-md: 16px;
            --radius-lg: 24px;
            --radius-xl: 32px;
            --radius-full: 50px;
            
            --transition-fast: 200ms cubic-bezier(0.4, 0, 0.2, 1);
            --transition-base: 300ms cubic-bezier(0.4, 0, 0.2, 1);
            --transition-slow: 500ms cubic-bezier(0.4, 0, 0.2, 1);
            --transition-bounce: 500ms cubic-bezier(0.34, 1.56, 0.64, 1);
            
            --shadow-sm: 0 2px 8px rgba(0, 0, 0, 0.15);
            --shadow-md: 0 8px 24px rgba(0, 0, 0, 0.25);
            --shadow-lg: 0 16px 48px rgba(0, 0, 0, 0.35);
            --shadow-xl: 0 24px 64px rgba(0, 0, 0, 0.45);
            --shadow-inner: inset 0 2px 8px rgba(0, 0, 0, 0.2);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            font-family: 'Tajawal', 'Cairo', sans-serif;
            background: linear-gradient(135deg, var(--dark-bg) 0%, #1e1b4b 100%);
            color: var(--dark-text);
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
            padding-top: 150px; /* ŸÖÿ≥ÿßÿ≠ÿ© ŸÑŸÑÿ±ÿ£ÿ≥ ÿßŸÑŸÖÿ™ÿ≠ÿ±ŸÉ */
        }

        /* ÿÆŸÑŸÅŸäÿ© ÿ¨ÿ≤Ÿäÿ¶ÿßÿ™ ŸÖÿ™ÿ≠ÿ±ŸÉÿ© */
        .particles-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -2;
            overflow: hidden;
        }

        .particle {
            position: absolute;
            border-radius: 50%;
            background: radial-gradient(circle at center, rgba(99, 102, 241, 0.3) 0%, transparent 70%);
            animation: float 20s infinite linear;
        }

        /* ÿ±ÿ£ÿ≥ ŸÖÿ™ÿ≠ÿ±ŸÉ ŸÖÿ™ÿ∫Ÿäÿ± ÿßŸÑÿ£ŸÑŸàÿßŸÜ */
        .dynamic-header {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 150px;
            background: linear-gradient(90deg, 
                #ff6b6b, #ffa8a8, #ffd8a8, 
                #d8b4fe, #a5b4fc, #6ee7b7);
            background-size: 400% 400%;
            animation: gradientShift 15s ease infinite;
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            box-shadow: var(--shadow-lg);
            overflow: hidden;
        }

        .dynamic-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            animation: shine 3s infinite;
        }

        .header-title {
            font-size: 2.2rem;
            font-weight: 900;
            color: white;
            text-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
            padding: 0 20px;
            z-index: 2;
        }

        .header-subtitle {
            position: absolute;
            bottom: 15px;
            left: 0;
            width: 100%;
            text-align: center;
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.9);
            font-weight: 600;
            z-index: 2;
        }

        /* ÿßŸÑŸáŸäÿØÿ± ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿä */
        .app-header {
            background: linear-gradient(135deg, rgba(30, 41, 59, 0.8) 0%, rgba(15, 23, 42, 0.9) 100%);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--glass-border);
            padding: 50px 20px 40px;
            margin-bottom: 40px;
            position: relative;
            overflow: hidden;
            border-radius: 0 0 var(--radius-xl) var(--radius-xl);
        }

        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            text-align: center;
            position: relative;
            z-index: 2;
        }

        .app-logo {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 80px; /* ÿ™ÿµÿ∫Ÿäÿ± ÿßŸÑÿ≠ÿ¨ŸÖ */
            height: 80px; /* ÿ™ÿµÿ∫Ÿäÿ± ÿßŸÑÿ≠ÿ¨ŸÖ */
            background: radial-gradient(circle at center, var(--primary) 0%, var(--primary-dark) 100%);
            border-radius: var(--radius-lg);
            margin-bottom: 20px;
            box-shadow: var(--shadow-md);
            animation: float 3s ease-in-out infinite;
            position: relative;
            overflow: hidden;
        }

        .app-logo::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transform: translateX(-100%);
            animation: shine 3s infinite;
        }

        .app-logo i {
            font-size: 2.2rem; /* ÿ™ÿµÿ∫Ÿäÿ± ÿßŸÑÿ≠ÿ¨ŸÖ */
            color: white;
            filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.3));
        }

        .app-header h1 {
            font-size: 2.2rem;
            font-weight: 900;
            margin-bottom: 15px;
            background: linear-gradient(135deg, var(--primary-light), var(--secondary-light));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: 0 4px 20px rgba(99, 102, 241, 0.3);
        }

        .app-header .subtitle {
            font-size: 1.1rem;
            color: var(--dark-text-secondary);
            margin-bottom: 30px;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
            line-height: 1.6;
        }

        /* ÿßÿÆÿ™Ÿäÿßÿ± ÿßŸÑŸÅÿ™ÿ±ÿ© ÿßŸÑŸÖÿßŸÑŸäÿ© */
        .period-selector {
            background: var(--glass-bg);
            backdrop-filter: blur(10px);
            border-radius: var(--radius-lg);
            padding: 20px;
            margin-bottom: 30px;
            border: 1px solid var(--glass-border);
            box-shadow: var(--shadow-md);
            position: relative;
        }

        .period-header {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--dark-border);
        }

        .period-header i {
            color: var(--primary);
            font-size: 1.5rem;
        }

        .period-header h3 {
            font-size: 1.4rem;
            font-weight: 700;
            color: var(--dark-text);
            text-align: center;
        }

        .period-navigation {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            margin-bottom: 20px;
        }

        .nav-btn {
            width: 60px;
            height: 60px;
            border-radius: var(--radius-full);
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            cursor: pointer;
            transition: var(--transition-bounce);
            box-shadow: var(--shadow-md);
            position: relative;
            overflow: hidden;
        }

        .nav-btn:hover {
            transform: scale(1.1);
            box-shadow: var(--shadow-lg);
        }

        .nav-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
        }

        .nav-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transform: translateX(-100%);
        }

        .nav-btn:hover:not(:disabled)::before {
            animation: shine 1.5s;
        }

        .current-period-display {
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.1), rgba(16, 185, 129, 0.1));
            backdrop-filter: blur(10px);
            border-radius: var(--radius-md);
            padding: 20px;
            text-align: center;
            border: 2px solid var(--glass-border);
            min-width: 300px;
        }

        .period-name {
            font-size: 1.4rem;
            font-weight: 800;
            color: var(--dark-text);
            margin-bottom: 10px;
            background: linear-gradient(135deg, var(--primary-light), var(--secondary-light));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .period-dates {
            font-size: 1.1rem;
            color: var(--dark-text-secondary);
            font-weight: 600;
        }

        .period-stats {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 15px;
            font-size: 0.9rem;
            color: var(--dark-text-muted);
        }

        .period-stat {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        /* ÿ®ÿ∑ÿßŸÇÿ© ÿßŸÑÿ¥Ÿáÿ± */
        .month-card {
            display: inline-flex;
            align-items: center;
            gap: 15px;
            background: var(--glass-bg);
            backdrop-filter: blur(10px);
            padding: 15px 25px;
            border-radius: var(--radius-full);
            box-shadow: var(--shadow-md);
            border: 1px solid var(--glass-border);
            transition: var(--transition-base);
            position: relative;
            overflow: hidden;
        }

        .month-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.05), transparent);
            transform: translateX(-100%);
        }

        .month-card:hover::before {
            animation: shine 1.5s;
        }

        .month-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
            border-color: var(--primary);
        }

        .month-card i {
            color: var(--primary);
            font-size: 1.5rem;
        }

        .month-card span {
            font-weight: 800;
            color: var(--dark-text);
            font-size: 1.2rem;
            letter-spacing: 1px;
        }

        /* ÿßŸÑÿ≠ÿßŸàŸäÿ© ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ© */
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
            position: relative;
            z-index: 1;
        }

        /* ÿ¥ÿ®ŸÉÿ© ÿßŸÑÿ•ÿ≠ÿµÿßÿ¶Ÿäÿßÿ™ */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin-bottom: 40px;
        }

        .stat-card {
            background: linear-gradient(135deg, rgba(30, 41, 59, 0.7) 0%, rgba(15, 23, 42, 0.7) 100%);
            backdrop-filter: blur(20px);
            border-radius: var(--radius-lg);
            padding: 25px;
            box-shadow: var(--shadow-lg);
            border: 1px solid var(--glass-border);
            transition: var(--transition-base);
            position: relative;
            overflow: hidden;
            min-height: 180px;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, var(--primary) 0%, transparent 70%);
            opacity: 0.1;
            z-index: 0;
        }

        .stat-card:hover {
            transform: translateY(-8px);
            box-shadow: var(--shadow-xl);
            border-color: var(--primary);
        }

        .stat-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
            position: relative;
            z-index: 1;
        }

        .stat-icon {
            width: 60px; /* ÿ™ÿµÿ∫Ÿäÿ± ÿßŸÑÿ≠ÿ¨ŸÖ */
            height: 60px; /* ÿ™ÿµÿ∫Ÿäÿ± ÿßŸÑÿ≠ÿ¨ŸÖ */
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
            color: white;
            box-shadow: var(--shadow-md);
            position: relative;
            overflow: hidden;
        }

        .stat-icon::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transform: translateX(-100%);
        }

        .stat-card:hover .stat-icon::before {
            animation: shine 1.5s;
        }

        .stat-trend {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 15px;
            border-radius: var(--radius-full);
            font-size: 0.9rem;
            font-weight: 800;
            backdrop-filter: blur(10px);
        }

        .trend-up {
            background: rgba(16, 185, 129, 0.2);
            color: var(--secondary-light);
            border: 1px solid rgba(16, 185, 129, 0.3);
        }

        .trend-down {
            background: rgba(239, 68, 68, 0.2);
            color: #fca5a5;
            border: 1px solid rgba(239, 68, 68, 0.3);
        }

        .stat-amount {
            font-size: 2.5rem;
            font-weight: 900;
            color: var(--dark-text);
            margin-bottom: 8px;
            line-height: 1;
            position: relative;
            z-index: 1;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }

        .stat-label {
            font-size: 1rem;
            color: var(--dark-text-secondary);
            font-weight: 600;
            position: relative;
            z-index: 1;
        }

        /* ŸÅÿ¶ÿßÿ™ ÿßŸÑŸÖÿµÿ±ŸàŸÅÿßÿ™ */
        .categories-section {
            margin-bottom: 40px;
        }

        .section-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--dark-border);
            position: relative;
        }

        .section-header::after {
            content: '';
            position: absolute;
            bottom: -2px;
            right: 0;
            width: 100px;
            height: 2px;
            background: linear-gradient(90deg, var(--primary), transparent);
        }

        .section-title {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .section-title h2 {
            font-size: 1.8rem;
            font-weight: 800;
            color: var(--dark-text);
            background: linear-gradient(135deg, var(--primary-light), var(--secondary-light));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .section-title i {
            color: var(--primary);
            font-size: 1.6rem;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .section-count {
            background: var(--glass-bg);
            backdrop-filter: blur(10px);
            padding: 10px 20px;
            border-radius: var(--radius-full);
            font-weight: 800;
            color: var(--dark-text);
            border: 1px solid var(--glass-border);
            box-shadow: var(--shadow-sm);
        }

        .categories-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
        }

        .category-card {
            background: linear-gradient(135deg, rgba(30, 41, 59, 0.7) 0%, rgba(15, 23, 42, 0.7) 100%);
            backdrop-filter: blur(20px);
            border-radius: var(--radius-lg);
            padding: 25px;
            box-shadow: var(--shadow-lg);
            border: 2px solid transparent;
            transition: var(--transition-bounce);
            text-align: center;
            cursor: pointer;
            position: relative;
            overflow: hidden;
            min-height: 220px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .category-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, transparent, rgba(255, 255, 255, 0.05), transparent);
            transform: translateX(-100%);
        }

        .category-card:hover::before {
            animation: shine 1.5s;
        }

        .category-card:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: var(--shadow-xl);
            border-color: var(--primary);
        }

        .category-card.selected {
            border-color: var(--primary);
            box-shadow: 0 20px 60px rgba(99, 102, 241, 0.3);
            transform: translateY(-5px);
        }

        .category-icon {
            width: 70px; /* ÿ™ÿµÿ∫Ÿäÿ± ÿßŸÑÿ≠ÿ¨ŸÖ */
            height: 70px; /* ÿ™ÿµÿ∫Ÿäÿ± ÿßŸÑÿ≠ÿ¨ŸÖ */
            border-radius: var(--radius-md);
            margin: 0 auto 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
            color: white;
            box-shadow: var(--shadow-md);
            transition: var(--transition-base);
            position: relative;
            overflow: hidden;
        }

        .category-icon::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transform: translateX(-100%);
        }

        .category-card:hover .category-icon {
            transform: scale(1.1) rotate(10deg);
        }

        .category-card:hover .category-icon::before {
            animation: shine 1.5s;
        }

        .category-name {
            font-weight: 800;
            color: var(--dark-text);
            margin-bottom: 15px;
            font-size: 1.2rem;
            min-height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .progress-container {
            margin: 20px 0;
        }

        .progress-info {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-size: 0.9rem;
            font-weight: 700;
            color: var(--dark-text-secondary);
        }

        .progress-bar {
            height: 10px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: var(--radius-full);
            overflow: hidden;
            box-shadow: var(--shadow-inner);
            position: relative;
        }

        .progress-fill {
            height: 100%;
            border-radius: var(--radius-full);
            position: relative;
            overflow: hidden;
            transition: width 1s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        .progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            bottom: 0;
            left: 0;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
            animation: shimmer 2s infinite;
        }

        .category-stats {
            display: flex;
            justify-content: space-between;
            font-size: 0.95rem;
            font-weight: 800;
            margin-top: 10px;
        }

        .category-spent {
            color: var(--dark-text);
        }

        .category-remaining {
            color: var(--secondary-light);
        }

        /* ŸÜŸÖŸàÿ∞ÿ¨ ÿ•ÿ∂ÿßŸÅÿ© ŸÖÿµÿ±ŸàŸÅ */
        .expense-form-section {
            background: linear-gradient(135deg, rgba(30, 41, 59, 0.8) 0%, rgba(15, 23, 42, 0.8) 100%);
            backdrop-filter: blur(20px);
            border-radius: var(--radius-lg);
            padding: 30px;
            box-shadow: var(--shadow-xl);
            margin-bottom: 40px;
            border: 1px solid var(--glass-border);
            position: relative;
            overflow: hidden;
        }

        .expense-form-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.1), transparent 30%);
        }

        .form-header {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 2px solid var(--dark-border);
            position: relative;
            z-index: 1;
        }

        .form-header::after {
            content: '';
            position: absolute;
            bottom: -2px;
            right: 0;
            width: 150px;
            height: 2px;
            background: linear-gradient(90deg, var(--primary), transparent);
        }

        .form-header i {
            font-size: 2rem;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.3));
        }

        .form-header h3 {
            font-size: 1.8rem;
            font-weight: 800;
            color: var(--dark-text);
        }

        .selected-category-display {
            background: rgba(99, 102, 241, 0.1);
            backdrop-filter: blur(10px);
            padding: 20px;
            border-radius: var(--radius-md);
            margin-bottom: 25px;
            border: 2px dashed rgba(99, 102, 241, 0.3);
            display: flex;
            align-items: center;
            justify-content: space-between;
            animation: pulse 2s infinite;
            position: relative;
            z-index: 1;
            transition: var(--transition-base);
        }

        .selected-category-display:hover {
            border-color: var(--primary);
            transform: translateY(-3px);
            box-shadow: var(--shadow-md);
        }

        .category-info {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .selected-icon {
            width: 60px;
            height: 60px;
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.6rem;
            color: white;
            box-shadow: var(--shadow-md);
            position: relative;
            overflow: hidden;
        }

        .selected-icon::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transform: translateX(-100%);
        }

        .selected-category-display:hover .selected-icon::before {
            animation: shine 1.5s;
        }

        .category-details h4 {
            font-weight: 800;
            color: var(--dark-text);
            margin-bottom: 5px;
            font-size: 1.3rem;
        }

        .category-details p {
            color: var(--dark-text-secondary);
            font-size: 1rem;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
            position: relative;
            z-index: 1;
        }

        .form-group {
            margin-bottom: 0;
        }

        .form-label {
            display: block;
            margin-bottom: 12px;
            font-weight: 800;
            color: var(--dark-text);
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1rem;
        }

        .form-label i {
            color: var(--primary);
            font-size: 1.1rem;
        }

        .form-input {
            width: 100%;
            padding: 15px;
            border: 2px solid var(--dark-border);
            border-radius: var(--radius-md);
            font-size: 1rem;
            font-family: inherit;
            transition: var(--transition-fast);
            background: rgba(15, 23, 42, 0.5);
            color: var(--dark-text);
            backdrop-filter: blur(10px);
        }

        .form-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.2);
            background: rgba(15, 23, 42, 0.8);
        }

        .form-input::placeholder {
            color: var(--dark-text-muted);
        }

        .form-textarea {
            resize: vertical;
            min-height: 100px;
        }

        /* ÿ£ÿ≤ÿ±ÿßÿ± ŸÖÿ™ÿ∑Ÿàÿ±ÿ© */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            padding: 15px 25px;
            border: none;
            border-radius: var(--radius-md);
            font-size: 1rem;
            font-weight: 800;
            cursor: pointer;
            transition: var(--transition-bounce);
            font-family: inherit;
            position: relative;
            overflow: hidden;
            letter-spacing: 0.5px;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            right: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transition: right 0.6s ease;
        }

        .btn:hover::before {
            right: 100%;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            box-shadow: var(--shadow-lg);
        }

        .btn-primary:hover {
            transform: translateY(-5px) scale(1.05);
            box-shadow: var(--shadow-xl);
        }

        .btn-secondary {
            background: linear-gradient(135deg, var(--secondary) 0%, var(--secondary-dark) 100%);
            color: white;
            box-shadow: var(--shadow-lg);
        }

        .btn-outline {
            background: transparent;
            color: var(--primary);
            border: 2px solid var(--primary);
            backdrop-filter: blur(10px);
        }

        .btn-outline:hover {
            background: var(--primary);
            color: white;
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
        }

        .btn-block {
            width: 100%;
        }

        /* ÿßŸÑŸÖÿµÿ±ŸàŸÅÿßÿ™ ÿßŸÑÿ≠ÿØŸäÿ´ÿ© */
        .expenses-section {
            margin-bottom: 60px;
        }

        .expenses-container {
            background: linear-gradient(135deg, rgba(30, 41, 59, 0.8) 0%, rgba(15, 23, 42, 0.8) 100%);
            backdrop-filter: blur(20px);
            border-radius: var(--radius-lg);
            padding: 30px;
            box-shadow: var(--shadow-xl);
            border: 1px solid var(--glass-border);
        }

        .expenses-list {
            max-height: 500px;
            overflow-y: auto;
            padding-right: 10px;
        }

        .category-group {
            margin-bottom: 25px;
        }

        .group-header {
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.1) 0%, rgba(16, 185, 129, 0.1) 100%);
            backdrop-filter: blur(10px);
            padding: 20px;
            border-radius: var(--radius-md);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border: 1px solid var(--glass-border);
            transition: var(--transition-base);
        }

        .group-header:hover {
            transform: translateX(-5px);
            border-color: var(--primary);
        }

        .group-title {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .group-icon {
            width: 50px;
            height: 50px;
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.4rem;
            color: white;
            box-shadow: var(--shadow-sm);
            position: relative;
            overflow: hidden;
        }

        .group-icon::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transform: translateX(-100%);
        }

        .group-header:hover .group-icon::before {
            animation: shine 1.5s;
        }

        .group-name {
            font-weight: 800;
            font-size: 1.2rem;
            color: var(--dark-text);
        }

        .group-total {
            font-weight: 900;
            font-size: 1.5rem;
            color: var(--dark-text);
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }

        .expense-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 20px;
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border-radius: var(--radius-md);
            margin-bottom: 12px;
            border-right: 5px solid;
            transition: var(--transition-bounce);
            border: 1px solid transparent;
        }

        .expense-item:hover {
            transform: translateX(-8px);
            background: rgba(255, 255, 255, 0.08);
            border-color: var(--glass-border);
        }

        .expense-info {
            flex: 1;
        }

        .expense-date {
            display: flex;
            align-items: center;
            gap: 10px;
            color: var(--dark-text-secondary);
            font-size: 0.95rem;
            margin-bottom: 8px;
            font-weight: 600;
        }

        .expense-notes {
            color: var(--dark-text);
            font-weight: 600;
            font-size: 1rem;
            line-height: 1.5;
        }

        .expense-amount {
            font-weight: 900;
            font-size: 1.3rem;
            color: var(--dark-text);
            text-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
            min-width: 100px;
            text-align: left;
        }

        .expense-actions {
            display: flex;
            gap: 10px;
            margin-right: 15px;
        }

        .delete-btn {
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid rgba(239, 68, 68, 0.3);
            color: var(--danger);
            cursor: pointer;
            width: 40px;
            height: 40px;
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition-bounce);
            font-size: 1.1rem;
        }

        .delete-btn:hover {
            background: var(--danger);
            color: white;
            transform: scale(1.1) rotate(15deg);
            box-shadow: 0 8px 24px rgba(239, 68, 68, 0.3);
        }

        .edit-btn {
            background: rgba(59, 130, 246, 0.1);
            border: 1px solid rgba(59, 130, 246, 0.3);
            color: var(--info);
            cursor: pointer;
            width: 40px;
            height: 40px;
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition-bounce);
            font-size: 1.1rem;
        }

        .edit-btn:hover {
            background: var(--info);
            color: white;
            transform: scale(1.1) rotate(15deg);
            box-shadow: 0 8px 24px rgba(59, 130, 246, 0.3);
        }

        /* ÿ≤ÿ± ÿßŸÑÿ•ÿØÿßÿ±ÿ© */
        .admin-fab {
            position: fixed;
            bottom: 30px;
            left: 30px;
            z-index: 1000;
        }

        .admin-btn {
            width: 70px;
            height: 70px;
            border-radius: var(--radius-full);
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            border: none;
            box-shadow: var(--shadow-xl);
            cursor: pointer;
            transition: var(--transition-bounce);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
            position: relative;
            overflow: hidden;
        }

        .admin-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transform: translateX(-100%);
        }

        .admin-btn:hover {
            transform: scale(1.15) rotate(15deg);
            box-shadow: 0 20px 50px rgba(99, 102, 241, 0.4);
        }

        .admin-btn:hover::before {
            animation: shine 1.5s;
        }

        /* ÿßŸÑŸÖŸàÿØŸäŸàŸÑÿßÿ™ */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(15, 23, 42, 0.9);
            backdrop-filter: blur(20px);
            z-index: 2000;
            justify-content: center;
            align-items: center;
            animation: fadeIn var(--transition-base);
            padding: 20px;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: linear-gradient(135deg, rgba(30, 41, 59, 0.95) 0%, rgba(15, 23, 42, 0.95) 100%);
            backdrop-filter: blur(30px);
            border-radius: var(--radius-xl);
            width: 100%;
            max-width: 600px;
            max-height: 85vh;
            overflow-y: auto;
            box-shadow: var(--shadow-2xl);
            animation: slideUp var(--transition-bounce);
            border: 1px solid var(--glass-border);
        }

        .modal-header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            padding: 25px;
            border-radius: var(--radius-xl) var(--radius-xl) 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: relative;
            overflow: hidden;
        }

        .modal-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transform: translateX(-100%);
        }

        .modal.active .modal-header::before {
            animation: shine 2s;
        }

        .modal-header h3 {
            font-size: 1.6rem;
            font-weight: 800;
            display: flex;
            align-items: center;
            gap: 15px;
            position: relative;
            z-index: 1;
        }

        .close-modal {
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            width: 45px;
            height: 45px;
            border-radius: var(--radius-full);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition-bounce);
            position: relative;
            z-index: 1;
        }

        .close-modal:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: rotate(90deg) scale(1.1);
        }

        .modal-body {
            padding: 25px;
        }

        /* ÿ¥ÿßÿ¥ÿ© ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ */
        .loading-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, var(--dark-bg) 0%, #1e1b4b 100%);
            backdrop-filter: blur(30px);
            z-index: 9999;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            gap: 25px;
        }

        .loading-overlay.active {
            display: flex;
        }

        .loader {
            width: 70px;
            height: 70px;
            border: 5px solid rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            border-top-color: var(--primary);
            border-right-color: var(--secondary);
            border-bottom-color: var(--accent);
            animation: spin 1.5s ease-in-out infinite;
        }

        .loading-text {
            font-size: 1.1rem;
            color: var(--dark-text-secondary);
            font-weight: 600;
            animation: pulse 2s infinite;
        }

        /* ÿßŸÑÿ•ÿ¥ÿπÿßÿ±ÿßÿ™ */
        .notification {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: linear-gradient(135deg, var(--secondary) 0%, var(--secondary-dark) 100%);
            color: white;
            padding: 20px 25px;
            border-radius: var(--radius-md);
            box-shadow: var(--shadow-xl);
            z-index: 1000;
            display: flex;
            align-items: center;
            gap: 15px;
            max-width: 400px;
            animation: slideInRight var(--transition-bounce);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .notification.hidden {
            animation: slideOutRight var(--transition-base);
            transform: translateX(150%);
            opacity: 0;
        }

        .notification i {
            font-size: 1.6rem;
        }

        .notification.error {
            background: linear-gradient(135deg, var(--danger) 0%, #b91c1c 100%);
        }

        .notification.warning {
            background: linear-gradient(135deg, var(--warning) 0%, #d97706 100%);
        }

        /* ÿßŸÑŸÅŸàÿ™ÿ± */
        .app-footer {
            text-align: center;
            padding: 30px;
            color: var(--dark-text-secondary);
            font-size: 0.95rem;
            border-top: 1px solid var(--dark-border);
            margin-top: 40px;
            background: rgba(15, 23, 42, 0.8);
            backdrop-filter: blur(20px);
        }

        .app-footer p:first-child {
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--dark-text);
        }

        .app-footer .version {
            font-size: 0.85rem;
            color: var(--dark-text-muted);
            margin-top: 10px;
        }

        /* ÿ£ŸÜŸäŸÖŸäÿ¥ŸÜ ŸÖÿÆÿµÿµÿ© */
        @keyframes float {
            0%, 100% {
                transform: translateY(0) translateX(0);
            }
            50% {
                transform: translateY(-15px) translateX(8px);
            }
        }

        @keyframes gradientShift {
            0% {
                background-position: 0% 50%;
            }
            50% {
                background-position: 100% 50%;
            }
            100% {
                background-position: 0% 50%;
            }
        }

        @keyframes shine {
            0% {
                transform: translateX(-100%);
            }
            100% {
                transform: translateX(100%);
            }
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(60px) scale(0.9);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        @keyframes slideInRight {
            from {
                opacity: 0;
                transform: translateX(60px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        @keyframes slideOutRight {
            from {
                opacity: 1;
                transform: translateX(0);
            }
            to {
                opacity: 0;
                transform: translateX(150%);
            }
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        @keyframes pulse {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: 0.7;
            }
        }

        @keyframes shimmer {
            0% {
                transform: translateX(-100%);
            }
            100% {
                transform: translateX(100%);
            }
        }

        /* ÿ£ŸÜŸäŸÖŸäÿ¥ŸÜ ÿ¨ÿ≤Ÿäÿ¶ÿßÿ™ */
        @keyframes particleFloat {
            0%, 100% {
                transform: translateY(0) translateX(0);
            }
            25% {
                transform: translateY(-30px) translateX(15px);
            }
            50% {
                transform: translateY(-15px) translateX(-15px);
            }
            75% {
                transform: translateY(30px) translateX(8px);
            }
        }

        /* ÿßŸÑÿ™ÿ¨ÿßŸàÿ® */
        @media (max-width: 1200px) {
            .container {
                max-width: 1000px;
            }
            
            .categories-grid {
                grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            }
        }

        @media (max-width: 768px) {
            body {
                padding-top: 120px;
            }
            
            .dynamic-header {
                height: 120px;
            }
            
            .header-title {
                font-size: 1.8rem;
            }
            
            .app-header {
                padding: 30px 15px;
            }
            
            .app-header h1 {
                font-size: 1.8rem;
            }
            
            .app-logo {
                width: 60px;
                height: 60px;
            }
            
            .app-logo i {
                font-size: 1.8rem;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            
            .categories-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 15px;
            }
            
            .expense-form-section {
                padding: 20px;
            }
            
            .form-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            
            .selected-category-display {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }
            
            .category-info {
                flex-direction: column;
                text-align: center;
            }
            
            .admin-fab {
                bottom: 15px;
                left: 15px;
            }
            
            .admin-btn {
                width: 50px;
                height: 50px;
                font-size: 1.3rem;
            }
            
            .notification {
                right: 15px;
                bottom: 15px;
                left: 15px;
                max-width: none;
            }
            
            .section-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 12px;
            }
            
            .period-navigation {
                gap: 10px;
            }
            
            .current-period-display {
                min-width: 250px;
            }
            
            .nav-btn {
                width: 50px;
                height: 50px;
            }
        }

        @media (max-width: 480px) {
            body {
                padding-top: 100px;
            }
            
            .dynamic-header {
                height: 100px;
            }
            
            .header-title {
                font-size: 1.5rem;
            }
            
            .app-header {
                padding: 20px 10px;
            }
            
            .app-header h1 {
                font-size: 1.5rem;
            }
            
            .app-header .subtitle {
                font-size: 0.95rem;
            }
            
            .month-card {
                padding: 12px 20px;
            }
            
            .categories-grid {
                grid-template-columns: 1fr;
            }
            
            .stat-card {
                padding: 20px;
            }
            
            .stat-amount {
                font-size: 2rem;
            }
            
            .form-header h3 {
                font-size: 1.4rem;
            }
            
            .expense-form-section {
                padding: 15px;
            }
            
            .btn {
                padding: 12px 20px;
                font-size: 0.95rem;
            }
            
            .expenses-container {
                padding: 20px;
            }
            
            .group-header {
                flex-direction: column;
                gap: 12px;
                align-items: flex-start;
            }
            
            .expense-item {
                flex-direction: column;
                gap: 12px;
                align-items: flex-start;
            }
            
            .expense-actions {
                margin-right: 0;
                align-self: flex-end;
            }
            
            .period-navigation {
                flex-direction: column;
                gap: 15px;
            }
            
            .current-period-display {
                min-width: 200px;
            }
        }

        /* ÿ¥ÿ±Ÿäÿ∑ ÿßŸÑÿ™ŸÖÿ±Ÿäÿ± ÿßŸÑŸÖÿÆÿµÿµ */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: var(--radius-full);
        }

        ::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border-radius: var(--radius-full);
        }

        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(135deg, var(--primary-dark), var(--secondary-dark));
        }
    </style>
</head>
<body>
    <!-- ÿ±ÿ£ÿ≥ ŸÖÿ™ÿ≠ÿ±ŸÉ ŸÖÿ™ÿ∫Ÿäÿ± ÿßŸÑÿ£ŸÑŸàÿßŸÜ -->
    <div class="dynamic-header">
        <div class="header-title">ÿ•ÿØÿßÿ±ÿ© ÿßŸÑŸÖÿµÿ±ŸàŸÅÿßÿ™ ÿßŸÑÿ∞ŸÉŸäÿ©</div>
        <div class="header-subtitle">ÿ™ÿµŸÖŸäŸÖ Ÿàÿ™ÿ∑ŸàŸäÿ±: ŸÖŸáŸÜÿØÿ≥ ÿ®ŸàŸÑÿ≥ ÿ≥ŸÖŸäÿ± ÿ¨ÿ±ÿ≥</div>
    </div>
    
    <!-- ÿÆŸÑŸÅŸäÿ© ÿ¨ÿ≤Ÿäÿ¶ÿßÿ™ ŸÖÿ™ÿ≠ÿ±ŸÉÿ© -->
    <div class="particles-bg" id="particles-bg"></div>
    
    <!-- ÿ¥ÿßÿ¥ÿ© ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ -->
    <div class="loading-overlay" id="loading-overlay">
        <div class="loader"></div>
        <div class="loading-text">ÿ¨ÿßÿ±Ÿä ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™...</div>
    </div>
    
    <!-- ÿßŸÑŸáŸäÿØÿ± -->
    <header class="app-header">
        <div class="header-content">
            <div class="app-logo">
                <i class="fas fa-chart-line"></i>
            </div>
            <h1>ÿ•ÿØÿßÿ±ÿ© ÿßŸÑŸÖÿµÿ±ŸàŸÅÿßÿ™ ÿßŸÑÿ∞ŸÉŸäÿ©</h1>
            <p class="subtitle">ŸÜÿ∏ÿßŸÖ ŸÖÿ™ŸÉÿßŸÖŸÑ ŸÑŸÑÿ™ÿ≠ŸÉŸÖ ŸÅŸä ŸÖŸäÿ≤ÿßŸÜŸäÿ™ŸÉ ÿßŸÑÿ¥Ÿáÿ±Ÿäÿ© Ÿàÿ™ÿ™ÿ®ÿπ ŸÖÿµÿ±ŸàŸÅÿßÿ™ŸÉ ÿßŸÑŸäŸàŸÖŸäÿ© ÿ®ŸÜÿ∏ÿßŸÖ ÿ∞ŸÉŸä Ÿàÿßÿ≠ÿ™ÿ±ÿßŸÅŸä</p>
            <div class="month-card" id="month-display">
                <i class="fas fa-calendar-alt"></i>
                <span id="current-month">ÿßŸÑŸÖÿµÿßÿ±ŸäŸÅ ÿßŸÑÿ¥Ÿáÿ±Ÿäÿ©</span>
            </div>
        </div>
    </header>
    
    <!-- ÿßŸÑŸÖÿ≠ÿ™ŸàŸâ ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿä -->
    <main class="container">
        <!-- ÿßÿÆÿ™Ÿäÿßÿ± ÿßŸÑŸÅÿ™ÿ±ÿ© ÿßŸÑŸÖÿßŸÑŸäÿ© -->
        <section class="period-selector">
            <div class="period-header">
                <i class="fas fa-calendar-week"></i>
                <h3>ÿßÿÆÿ™ÿ± ÿßŸÑŸÅÿ™ÿ±ÿ© ÿßŸÑŸÖÿßŸÑŸäÿ©</h3>
            </div>
            
            <div class="period-navigation">
                <button class="nav-btn" id="prev-period-btn">
                    <i class="fas fa-chevron-right"></i>
                </button>
                
                <div class="current-period-display">
                    <div class="period-name" id="current-period-name">ÿßŸÑŸÅÿ™ÿ±ÿ© ÿßŸÑÿ£ŸàŸÑŸâ</div>
                    <div class="period-dates" id="current-period-dates">24 ÿØŸäÿ≥ŸÖÿ®ÿ± 2025 - 23 ŸäŸÜÿßŸäÿ± 2026</div>
                    <div class="period-stats">
                        <div class="period-stat">
                            <i class="fas fa-tags"></i>
                            <span id="period-categories-count">0 ŸÅÿ¶ÿ©</span>
                        </div>
                        <div class="period-stat">
                            <i class="fas fa-receipt"></i>
                            <span id="period-expenses-count">0 ŸÖÿµÿ±ŸàŸÅ</span>
                        </div>
                    </div>
                </div>
                
                <button class="nav-btn" id="next-period-btn">
                    <i class="fas fa-chevron-left"></i>
                </button>
            </div>
        </section>
        
        <!-- ÿßŸÑÿ•ÿ≠ÿµÿßÿ¶Ÿäÿßÿ™ -->
        <section class="stats-grid">
            <div class="stat-card">
                <div class="stat-header">
                    <div class="stat-icon" style="background: linear-gradient(135deg, var(--primary), var(--primary-dark));">
                        <i class="fas fa-money-bill-wave"></i>
                    </div>
                    <div class="stat-trend trend-up">
                        <i class="fas fa-arrow-up"></i>
                        <span>+15%</span>
                    </div>
                </div>
                <div class="stat-amount" id="total-expenses">0 ÿ¨.ŸÖ</div>
                <div class="stat-label">ÿ•ÿ¨ŸÖÿßŸÑŸä ÿßŸÑŸÖÿµÿ±ŸàŸÅÿßÿ™</div>
            </div>
            
            <div class="stat-card">
                <div class="stat-header">
                    <div class="stat-icon" style="background: linear-gradient(135deg, var(--secondary), var(--secondary-dark));">
                        <i class="fas fa-coins"></i>
                    </div>
                    <div class="stat-trend trend-down">
                        <i class="fas fa-arrow-down"></i>
                        <span>-5%</span>
                    </div>
                </div>
                <div class="stat-amount" id="remaining-budget">0 ÿ¨.ŸÖ</div>
                <div class="stat-label">ÿßŸÑŸÖŸäÿ≤ÿßŸÜŸäÿ© ÿßŸÑŸÖÿ™ÿ®ŸÇŸäÿ©</div>
            </div>
            
            <div class="stat-card">
                <div class="stat-header">
                    <div class="stat-icon" style="background: linear-gradient(135deg, var(--accent), #d97706);">
                        <i class="fas fa-sun"></i>
                    </div>
                    <div class="stat-trend trend-up">
                        <i class="fas fa-arrow-up"></i>
                        <span>+8%</span>
                    </div>
                </div>
                <div class="stat-amount" id="today-expenses">0 ÿ¨.ŸÖ</div>
                <div class="stat-label">ŸÖÿµÿ±ŸàŸÅÿßÿ™ ÿßŸÑŸäŸàŸÖ</div>
            </div>
        </section>
        
        <!-- ŸÅÿ¶ÿßÿ™ ÿßŸÑŸÖÿµÿ±ŸàŸÅÿßÿ™ -->
        <section class="categories-section">
            <div class="section-header">
                <div class="section-title">
                    <i class="fas fa-tags"></i>
                    <h2>ŸÅÿ¶ÿßÿ™ ÿßŸÑŸÖÿµÿ±ŸàŸÅÿßÿ™</h2>
                </div>
                <div class="section-count" id="categories-count">0 ŸÅÿ¶ÿ©</div>
            </div>
            <div class="categories-grid" id="categories-container">
                <!-- Ÿäÿ™ŸÖ ÿ™ÿπÿ®ÿ¶ÿ™Ÿáÿß ÿØŸäŸÜÿßŸÖŸäŸÉŸäŸãÿß -->
            </div>
        </section>
        
        <!-- ŸÜŸÖŸàÿ∞ÿ¨ ÿ•ÿ∂ÿßŸÅÿ© ŸÖÿµÿ±ŸàŸÅ -->
        <section class="expense-form-section">
            <div class="form-header">
                <i class="fas fa-plus-circle"></i>
                <h3>ÿ•ÿ∂ÿßŸÅÿ© ŸÖÿµÿ±ŸàŸÅ ÿ¨ÿØŸäÿØ</h3>
            </div>
            
            <!-- ÿßŸÑŸÅÿ¶ÿ© ÿßŸÑŸÖÿÆÿ™ÿßÿ±ÿ© -->
            <div class="selected-category-display" id="selected-category-display" style="display: none;">
                <div class="category-info">
                    <div class="selected-icon" id="selected-category-icon">
                        <i class="fas fa-tag"></i>
                    </div>
                    <div class="category-details">
                        <h4 id="selected-category-name">ŸÅÿ¶ÿ© ÿ∫Ÿäÿ± ŸÖÿÆÿ™ÿßÿ±ÿ©</h4>
                        <p id="selected-category-limit">ÿßŸÑÿ≠ÿØ: 0 ÿ¨.ŸÖ | ÿßŸÑŸÖÿ™ÿ®ŸÇŸä: 0 ÿ¨.ŸÖ</p>
                    </div>
                </div>
                <button type="button" class="btn btn-outline" id="change-category-btn">
                    <i class="fas fa-exchange-alt"></i>
                    ÿ™ÿ∫ŸäŸäÿ± ÿßŸÑŸÅÿ¶ÿ©
                </button>
            </div>
            
            <!-- ÿßŸÑŸÜŸÖŸàÿ∞ÿ¨ -->
            <form id="add-expense-form">
                <input type="hidden" id="category-id">
                <input type="hidden" id="period-id">
                
                <div class="form-grid">
                    <div class="form-group">
                        <label for="amount" class="form-label">
                            <i class="fas fa-money-bill-wave"></i>
                            ÿßŸÑŸÖÿ®ŸÑÿ∫ (ÿ¨.ŸÖ)
                        </label>
                        <input type="number" id="amount" class="form-input" min="1" step="0.01" required placeholder="ÿ£ÿØÿÆŸÑ ÿßŸÑŸÖÿ®ŸÑÿ∫">
                    </div>
                    
                    <div class="form-group">
                        <label for="expense-date" class="form-label">
                            <i class="fas fa-calendar-day"></i>
                            ÿßŸÑÿ™ÿßÿ±ŸäÿÆ
                        </label>
                        <input type="date" id="expense-date" class="form-input" required>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="notes" class="form-label">
                        <i class="fas fa-sticky-note"></i>
                        ŸÖŸÑÿßÿ≠ÿ∏ÿßÿ™ (ÿßÿÆÿ™Ÿäÿßÿ±Ÿä)
                    </label>
                    <textarea id="notes" class="form-input form-textarea" rows="3" placeholder="ÿ£ÿØÿÆŸÑ ÿ£Ÿä ŸÖŸÑÿßÿ≠ÿ∏ÿßÿ™ ÿ•ÿ∂ÿßŸÅŸäÿ©"></textarea>
                </div>
                
                <button type="submit" class="btn btn-primary btn-block" id="save-expense-btn">
                    <i class="fas fa-save"></i>
                    ÿ≠ŸÅÿ∏ ÿßŸÑŸÖÿµÿ±ŸàŸÅ
                </button>
            </form>
        </section>
        
        <!-- ÿßŸÑŸÖÿµÿ±ŸàŸÅÿßÿ™ ÿßŸÑÿ≠ÿØŸäÿ´ÿ© -->
        <section class="expenses-section">
            <div class="section-header">
                <div class="section-title">
                    <i class="fas fa-history"></i>
                    <h2>ÿßŸÑŸÖÿµÿ±ŸàŸÅÿßÿ™ ÿßŸÑÿ≠ÿØŸäÿ´ÿ©</h2>
                </div>
                <div class="section-count" id="expenses-count">0 ŸÖÿµÿ±ŸàŸÅ</div>
            </div>
            <div class="expenses-container">
                <div class="expenses-list" id="expenses-list">
                    <!-- Ÿäÿ™ŸÖ ÿ™ÿπÿ®ÿ¶Ÿäÿ™Ÿáÿß ÿØŸäŸÜÿßŸÖŸäŸÉŸäŸãÿß -->
                </div>
            </div>
        </section>
    </main>
    
    <!-- ÿ≤ÿ± ÿßŸÑÿ•ÿØÿßÿ±ÿ© -->
    <div class="admin-fab">
        <button class="admin-btn" id="admin-btn">
            <i class="fas fa-cog"></i>
        </button>
    </div>
    
    <!-- ŸÖŸàÿØŸäŸàŸÑ ÿßŸÑÿ•ÿØÿßÿ±ÿ© -->
    <div class="modal" id="admin-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-cogs"></i> ŸÑŸàÿ≠ÿ© ÿßŸÑÿ™ÿ≠ŸÉŸÖ</h3>
                <button class="close-modal" id="close-admin-modal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div style="display: flex; flex-direction: column; gap: 15px;">
                    <button class="btn btn-primary" id="manage-categories-btn">
                        <i class="fas fa-tags"></i>
                        ÿ•ÿØÿßÿ±ÿ© ÿßŸÑŸÅÿ¶ÿßÿ™
                    </button>
                    <button class="btn btn-primary" id="set-budget-btn">
                        <i class="fas fa-wallet"></i>
                        ÿ™ÿπÿØŸäŸÑ ÿßŸÑŸÖŸäÿ≤ÿßŸÜŸäÿ©
                    </button>
                    <button class="btn btn-primary" id="view-all-expenses-btn">
                        <i class="fas fa-list-alt"></i>
                        ÿ¨ŸÖŸäÿπ ÿßŸÑŸÖÿµÿ±ŸàŸÅÿßÿ™
                    </button>
                    <button class="btn btn-secondary" id="export-data-btn">
                        <i class="fas fa-download"></i>
                        ÿ™ÿµÿØŸäÿ± ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™
                    </button>
                    <button class="btn btn-outline" id="reset-data-btn">
                        <i class="fas fa-trash"></i>
                        ÿ•ÿπÿßÿØÿ© ÿßŸÑÿ∂ÿ®ÿ∑
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- ŸÖŸàÿØŸäŸàŸÑ ÿ•ÿØÿßÿ±ÿ© ÿßŸÑŸÅÿ¶ÿßÿ™ -->
    <div class="modal" id="categories-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-tags"></i> ÿ•ÿØÿßÿ±ÿ© ÿßŸÑŸÅÿ¶ÿßÿ™</h3>
                <button class="close-modal" id="close-categories-modal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <form id="add-category-form" style="margin-bottom: 25px;">
                    <div class="form-group">
                        <label class="form-label">ÿßÿ≥ŸÖ ÿßŸÑŸÅÿ¶ÿ©</label>
                        <input type="text" id="new-category-name" class="form-input" required placeholder="ÿ£ÿØÿÆŸÑ ÿßÿ≥ŸÖ ÿßŸÑŸÅÿ¶ÿ©">
                    </div>
                    <div class="form-group">
                        <label class="form-label">ÿßŸÑÿ≠ÿØ ÿßŸÑÿ¥Ÿáÿ±Ÿä (ÿ¨.ŸÖ)</label>
                        <input type="number" id="new-category-limit" class="form-input" required placeholder="ÿ£ÿØÿÆŸÑ ÿßŸÑÿ≠ÿØ ÿßŸÑÿ¥Ÿáÿ±Ÿä">
                    </div>
                    <button type="submit" class="btn btn-primary btn-block">
                        <i class="fas fa-plus"></i>
                        ÿ•ÿ∂ÿßŸÅÿ© ŸÅÿ¶ÿ© ÿ¨ÿØŸäÿØÿ©
                    </button>
                </form>
                
                <div id="categories-list" style="max-height: 300px; overflow-y: auto; padding-right: 10px;">
                    <!-- Ÿäÿ™ŸÖ ÿ™ÿπÿ®ÿ¶Ÿäÿ™Ÿáÿß ÿØŸäŸÜÿßŸÖŸäŸÉŸäŸãÿß -->
                </div>
            </div>
        </div>
    </div>
    
    <!-- ŸÖŸàÿØŸäŸàŸÑ ÿ™ÿπÿØŸäŸÑ ÿßŸÑŸÅÿ¶ÿ© -->
    <div class="modal" id="edit-category-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-edit"></i> ÿ™ÿπÿØŸäŸÑ ÿßŸÑŸÅÿ¶ÿ©</h3>
                <button class="close-modal" id="close-edit-category-modal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <form id="edit-category-form">
                    <input type="hidden" id="edit-category-id">
                    <div class="form-group">
                        <label class="form-label">ÿßÿ≥ŸÖ ÿßŸÑŸÅÿ¶ÿ©</label>
                        <input type="text" id="edit-category-name" class="form-input" required placeholder="ÿßÿ≥ŸÖ ÿßŸÑŸÅÿ¶ÿ©">
                    </div>
                    <div class="form-group">
                        <label class="form-label">ÿßŸÑÿ≠ÿØ ÿßŸÑÿ¥Ÿáÿ±Ÿä (ÿ¨.ŸÖ)</label>
                        <input type="number" id="edit-category-limit" class="form-input" required placeholder="ÿßŸÑÿ≠ÿØ ÿßŸÑÿ¥Ÿáÿ±Ÿä">
                    </div>
                    <button type="submit" class="btn btn-primary btn-block">
                        <i class="fas fa-save"></i>
                        ÿ≠ŸÅÿ∏ ÿßŸÑÿ™ÿπÿØŸäŸÑÿßÿ™
                    </button>
                </form>
            </div>
        </div>
    </div>
    
    <!-- ŸÖŸàÿØŸäŸàŸÑ ÿ™ÿπÿØŸäŸÑ ÿßŸÑŸÖŸäÿ≤ÿßŸÜŸäÿ© -->
    <div class="modal" id="budget-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-wallet"></i> ÿ™ÿπÿØŸäŸÑ ÿßŸÑŸÖŸäÿ≤ÿßŸÜŸäÿ©</h3>
                <button class="close-modal" id="close-budget-modal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">ÿßŸÑŸÖŸäÿ≤ÿßŸÜŸäÿ© ÿßŸÑÿ•ÿ¨ŸÖÿßŸÑŸäÿ© (ÿ¨.ŸÖ)</label>
                    <input type="number" id="total-budget" class="form-input" required placeholder="ÿ£ÿØÿÆŸÑ ÿßŸÑŸÖŸäÿ≤ÿßŸÜŸäÿ© ÿßŸÑÿ•ÿ¨ŸÖÿßŸÑŸäÿ©">
                </div>
                <button class="btn btn-primary btn-block" id="save-budget-btn">
                    <i class="fas fa-save"></i>
                    ÿ≠ŸÅÿ∏ ÿßŸÑŸÖŸäÿ≤ÿßŸÜŸäÿ©
                </button>
            </div>
        </div>
    </div>
    
    <!-- ŸÖŸàÿØŸäŸàŸÑ ÿ¨ŸÖŸäÿπ ÿßŸÑŸÖÿµÿ±ŸàŸÅÿßÿ™ -->
    <div class="modal" id="all-expenses-modal">
        <div class="modal-content" style="max-width: 800px;">
            <div class="modal-header">
                <h3><i class="fas fa-list-alt"></i> ÿ¨ŸÖŸäÿπ ÿßŸÑŸÖÿµÿ±ŸàŸÅÿßÿ™</h3>
                <button class="close-modal" id="close-all-expenses-modal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <input type="text" id="search-expenses" class="form-input" placeholder="üîç ÿßÿ®ÿ≠ÿ´ ŸÅŸä ÿßŸÑŸÖÿµÿ±ŸàŸÅÿßÿ™...">
                </div>
                <div id="all-expenses-list" style="max-height: 400px; overflow-y: auto; margin-top: 15px; padding-right: 10px;">
                    <!-- Ÿäÿ™ŸÖ ÿ™ÿπÿ®ÿ¶Ÿäÿ™Ÿáÿß ÿØŸäŸÜÿßŸÖŸäŸÉŸäŸãÿß -->
                </div>
            </div>
        </div>
    </div>
    
    <!-- ÿ•ÿ¥ÿπÿßÿ±ÿßÿ™ -->
    <div class="notification hidden" id="notification">
        <i class="fas fa-check-circle"></i>
        <span id="notification-message">ÿ™ŸÖÿ™ ÿßŸÑÿπŸÖŸÑŸäÿ© ÿ®ŸÜÿ¨ÿßÿ≠</span>
    </div>
    
    <!-- ÿßŸÑŸÅŸàÿ™ÿ± -->
    <footer class="app-footer">
        <p>¬© 2024 ÿ™ÿ∑ÿ®ŸäŸÇ ÿ•ÿØÿßÿ±ÿ© ÿßŸÑŸÖÿµÿ±ŸàŸÅÿßÿ™ ÿßŸÑÿ∞ŸÉŸäÿ© | ÿ™ÿµŸÖŸäŸÖ Ÿàÿ™ÿ∑ŸàŸäÿ±: ŸÖŸáŸÜÿØÿ≥ ÿ®ŸàŸÑÿ≥ ÿ≥ŸÖŸäÿ± ÿ¨ÿ±ÿ≥</p>
        <p class="version">ÿ¨ŸÖŸäÿπ ÿßŸÑÿ≠ŸÇŸàŸÇ ŸÖÿ≠ŸÅŸàÿ∏ÿ© | ÿßŸÑŸÜÿ≥ÿÆÿ© 4.0 | ŸÜÿ∏ÿßŸÖ ÿ∞ŸÉŸä ŸÑÿ•ÿØÿßÿ±ÿ© ÿßŸÑŸÖŸäÿ≤ÿßŸÜŸäÿ©</p>
    </footer>

    <script>
        // ÿ™ŸáŸäÿ¶ÿ© Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyCBVxpqtMCzKH2BTKr70gI9UUlbJuHzFEw",
            authDomain: "masrof2-9e67a.firebaseapp.com",
            databaseURL: "https://masrof2-9e67a-default-rtdb.firebaseio.com",
            projectId: "masrof2-9e67a",
            storageBucket: "masrof2-9e67a.firebasestorage.app",
            messagingSenderId: "958997909952",
            appId: "1:958997909952:web:975ba540314a6389abb825"
        };

        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        // ÿ≠ÿßŸÑÿ© ÿßŸÑÿ™ÿ∑ÿ®ŸäŸÇ
        let categories = [];
        let expenses = [];
        let periods = [];
        let totalBudget = 10000;
        let selectedCategoryId = null;
        let currentPeriodIndex = 0;
        
        // ŸÜÿ∏ÿßŸÖ ÿ£ŸÑŸàÿßŸÜ ÿßŸÑŸÅÿ¶ÿßÿ™
        const categoryColors = [
            '#6366f1', '#10b981', '#f59e0b', '#ef4444',
            '#8b5cf6', '#06b6d4', '#84cc16', '#f97316',
            '#ec4899', '#14b8a6', '#eab308', '#a855f7',
            '#0ea5e9', '#22c55e', '#f43f5e', '#8b5cf6'
        ];
        
        // ÿßŸÑŸÅÿ™ÿ±ÿßÿ™ ÿßŸÑŸÖÿßŸÑŸäÿ©
        const financialPeriods = [
            {
                id: 'period1',
                name: 'ÿßŸÑŸÅÿ™ÿ±ÿ© ÿßŸÑÿ£ŸàŸÑŸâ',
                start: '2025-12-24',
                end: '2026-01-23',
                display: '24 ÿØŸäÿ≥ŸÖÿ®ÿ± 2025 - 23 ŸäŸÜÿßŸäÿ± 2026',
                year: '2025-2026'
            },
            {
                id: 'period2',
                name: 'ÿßŸÑŸÅÿ™ÿ±ÿ© ÿßŸÑÿ´ÿßŸÜŸäÿ©',
                start: '2026-02-24',
                end: '2026-03-23',
                display: '24 ŸÅÿ®ÿ±ÿßŸäÿ± 2026 - 23 ŸÖÿßÿ±ÿ≥ 2026',
                year: '2026'
            },
            {
                id: 'period3',
                name: 'ÿßŸÑŸÅÿ™ÿ±ÿ© ÿßŸÑÿ´ÿßŸÑÿ´ÿ©',
                start: '2026-04-24',
                end: '2026-05-23',
                display: '24 ÿ£ÿ®ÿ±ŸäŸÑ 2026 - 23 ŸÖÿßŸäŸà 2026',
                year: '2026'
            },
            {
                id: 'period4',
                name: 'ÿßŸÑŸÅÿ™ÿ±ÿ© ÿßŸÑÿ±ÿßÿ®ÿπÿ©',
                start: '2026-06-24',
                end: '2026-07-23',
                display: '24 ŸäŸàŸÜŸäŸà 2026 - 23 ŸäŸàŸÑŸäŸà 2026',
                year: '2026'
            },
            {
                id: 'period5',
                name: 'ÿßŸÑŸÅÿ™ÿ±ÿ© ÿßŸÑÿÆÿßŸÖÿ≥ÿ©',
                start: '2026-08-24',
                end: '2026-09-23',
                display: '24 ÿ£ÿ∫ÿ≥ÿ∑ÿ≥ 2026 - 23 ÿ≥ÿ®ÿ™ŸÖÿ®ÿ± 2026',
                year: '2026'
            },
            {
                id: 'period6',
                name: 'ÿßŸÑŸÅÿ™ÿ±ÿ© ÿßŸÑÿ≥ÿßÿØÿ≥ÿ©',
                start: '2026-10-24',
                end: '2026-11-23',
                display: '24 ÿ£ŸÉÿ™Ÿàÿ®ÿ± 2026 - 23 ŸÜŸàŸÅŸÖÿ®ÿ± 2026',
                year: '2026'
            },
            {
                id: 'period7',
                name: 'ÿßŸÑŸÅÿ™ÿ±ÿ© ÿßŸÑÿ≥ÿßÿ®ÿπÿ©',
                start: '2026-12-24',
                end: '2027-01-23',
                display: '24 ÿØŸäÿ≥ŸÖÿ®ÿ± 2026 - 23 ŸäŸÜÿßŸäÿ± 2027',
                year: '2026-2027'
            }
        ];
        
        // ÿßŸÑÿπŸÜÿßÿµÿ± DOM
        const elements = {
            loading: document.getElementById('loading-overlay'),
            loadingText: document.querySelector('.loading-text'),
            monthDisplay: document.getElementById('current-month'),
            totalExpenses: document.getElementById('total-expenses'),
            remainingBudget: document.getElementById('remaining-budget'),
            todayExpenses: document.getElementById('today-expenses'),
            categoriesCount: document.getElementById('categories-count'),
            categoriesContainer: document.getElementById('categories-container'),
            selectedCategoryDisplay: document.getElementById('selected-category-display'),
            selectedCategoryIcon: document.getElementById('selected-category-icon'),
            selectedCategoryName: document.getElementById('selected-category-name'),
            selectedCategoryLimit: document.getElementById('selected-category-limit'),
            categoryIdInput: document.getElementById('category-id'),
            periodIdInput: document.getElementById('period-id'),
            addExpenseForm: document.getElementById('add-expense-form'),
            saveExpenseBtn: document.getElementById('save-expense-btn'),
            changeCategoryBtn: document.getElementById('change-category-btn'),
            expensesCount: document.getElementById('expenses-count'),
            expensesList: document.getElementById('expenses-list'),
            adminBtn: document.getElementById('admin-btn'),
            adminModal: document.getElementById('admin-modal'),
            closeAdminModal: document.getElementById('close-admin-modal'),
            manageCategoriesBtn: document.getElementById('manage-categories-btn'),
            setBudgetBtn: document.getElementById('set-budget-btn'),
            viewAllExpensesBtn: document.getElementById('view-all-expenses-btn'),
            exportDataBtn: document.getElementById('export-data-btn'),
            resetDataBtn: document.getElementById('reset-data-btn'),
            categoriesModal: document.getElementById('categories-modal'),
            closeCategoriesModal: document.getElementById('close-categories-modal'),
            editCategoryModal: document.getElementById('edit-category-modal'),
            closeEditCategoryModal: document.getElementById('close-edit-category-modal'),
            budgetModal: document.getElementById('budget-modal'),
            closeBudgetModal: document.getElementById('close-budget-modal'),
            allExpensesModal: document.getElementById('all-expenses-modal'),
            closeAllExpensesModal: document.getElementById('close-all-expenses-modal'),
            notification: document.getElementById('notification'),
            notificationMessage: document.getElementById('notification-message'),
            totalBudgetInput: document.getElementById('total-budget'),
            saveBudgetBtn: document.getElementById('save-budget-btn'),
            addCategoryForm: document.getElementById('add-category-form'),
            editCategoryForm: document.getElementById('edit-category-form'),
            searchExpenses: document.getElementById('search-expenses'),
            prevPeriodBtn: document.getElementById('prev-period-btn'),
            nextPeriodBtn: document.getElementById('next-period-btn'),
            currentPeriodName: document.getElementById('current-period-name'),
            currentPeriodDates: document.getElementById('current-period-dates'),
            periodCategoriesCount: document.getElementById('period-categories-count'),
            periodExpensesCount: document.getElementById('period-expenses-count')
        };

        // ÿßŸÑÿ¥ŸáŸàÿ± ÿßŸÑÿπÿ±ÿ®Ÿäÿ©
        const arabicMonths = [
            'ŸäŸÜÿßŸäÿ±', 'ŸÅÿ®ÿ±ÿßŸäÿ±', 'ŸÖÿßÿ±ÿ≥', 'ÿ£ÿ®ÿ±ŸäŸÑ', 'ŸÖÿßŸäŸà', 'ŸäŸàŸÜŸäŸà',
            'ŸäŸàŸÑŸäŸà', 'ÿ£ÿ∫ÿ≥ÿ∑ÿ≥', 'ÿ≥ÿ®ÿ™ŸÖÿ®ÿ±', 'ÿ£ŸÉÿ™Ÿàÿ®ÿ±', 'ŸÜŸàŸÅŸÖÿ®ÿ±', 'ÿØŸäÿ≥ŸÖÿ®ÿ±'
        ];

        // ÿ•ŸÜÿ¥ÿßÿ° ÿ¨ÿ≤Ÿäÿ¶ÿßÿ™ ÿÆŸÑŸÅŸäÿ©
        function createParticles() {
            const container = document.getElementById('particles-bg');
            container.innerHTML = '';
            for (let i = 0; i < 30; i++) { // ÿ™ŸÇŸÑŸäŸÑ ÿπÿØÿØ ÿßŸÑÿ¨ÿ≤Ÿäÿ¶ÿßÿ™
                const particle = document.createElement('div');
                particle.className = 'particle';
                
                const size = Math.random() * 60 + 30; // ÿ™ÿµÿ∫Ÿäÿ± ÿßŸÑÿ≠ÿ¨ŸÖ
                const x = Math.random() * 100;
                const y = Math.random() * 100;
                const duration = Math.random() * 30 + 20;
                const delay = Math.random() * 10;
                
                particle.style.width = `${size}px`;
                particle.style.height = `${size}px`;
                particle.style.left = `${x}%`;
                particle.style.top = `${y}%`;
                particle.style.opacity = Math.random() * 0.08 + 0.05;
                particle.style.animation = `particleFloat ${duration}s infinite ${delay}s`;
                
                container.appendChild(particle);
            }
        }

        // ÿØŸàÿßŸÑ ÿßŸÑŸÖÿ≥ÿßÿπÿØÿ©
        function showLoading(text = 'ÿ¨ÿßÿ±Ÿä ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™...') {
            elements.loadingText.textContent = text;
            elements.loading.classList.add('active');
        }
        
        function hideLoading() {
            elements.loading.classList.remove('active');
        }
        
        function showNotification(message, type = 'success') {
            elements.notificationMessage.textContent = message;
            
            const icon = elements.notification.querySelector('i');
            elements.notification.className = `notification ${type}`;
            
            if (type === 'error') {
                icon.className = 'fas fa-exclamation-circle';
            } else if (type === 'warning') {
                icon.className = 'fas fa-exclamation-triangle';
            } else {
                icon.className = 'fas fa-check-circle';
            }
            
            elements.notification.classList.remove('hidden');
            
            setTimeout(() => {
                elements.notification.classList.add('hidden');
            }, 3000);
        }
        
        function setDefaultDate() {
            const today = new Date();
            const year = today.getFullYear();
            const month = String(today.getMonth() + 1).padStart(2, '0');
            const day = String(today.getDate()).padStart(2, '0');
            document.getElementById('expense-date').value = `${year}-${month}-${day}`;
        }
        
        function updateMonthDisplay() {
            const currentPeriod = financialPeriods[currentPeriodIndex];
            if (currentPeriod) {
                const displayText = `ÿßŸÑŸÖÿµÿßÿ±ŸäŸÅ - ${currentPeriod.year}`;
                elements.monthDisplay.textContent = displayText;
            }
        }

        // ÿØŸàÿßŸÑ ÿßŸÑŸÅÿ™ÿ±ÿßÿ™ ÿßŸÑŸÖÿßŸÑŸäÿ©
        function updatePeriodDisplay() {
            const currentPeriod = financialPeriods[currentPeriodIndex];
            
            // ÿ™ÿ≠ÿØŸäÿ´ ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑŸÅÿ™ÿ±ÿ©
            elements.currentPeriodName.textContent = currentPeriod.name;
            elements.currentPeriodDates.textContent = currentPeriod.display;
            
            // ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿ£ÿ≤ÿ±ÿßÿ±
            elements.prevPeriodBtn.disabled = currentPeriodIndex === 0;
            elements.nextPeriodBtn.disabled = currentPeriodIndex === financialPeriods.length - 1;
            
            // ÿ™ÿ≠ÿØŸäÿ´ ÿ•ÿ≠ÿµÿßÿ¶Ÿäÿßÿ™ ÿßŸÑŸÅÿ™ÿ±ÿ©
            updatePeriodStats();
            
            // ÿ™ÿ≠ÿØŸäÿ´ ÿπŸÜŸàÿßŸÜ ÿßŸÑÿ¥Ÿáÿ±
            updateMonthDisplay();
            
            // ÿ™ÿ≠ÿØŸäÿ´ ID ÿßŸÑŸÅÿ™ÿ±ÿ© ŸÅŸä ÿßŸÑŸÜŸÖŸàÿ∞ÿ¨
            elements.periodIdInput.value = currentPeriod.id;
            
            // ÿ•ÿπÿßÿØÿ© ÿ™ÿπŸäŸäŸÜ ÿßŸÑŸÅÿ¶ÿ© ÿßŸÑŸÖÿÆÿ™ÿßÿ±ÿ©
            selectedCategoryId = null;
            renderSelectedCategory();
        }
        
        function nextPeriod() {
            if (currentPeriodIndex < financialPeriods.length - 1) {
                currentPeriodIndex++;
                saveCurrentPeriodIndex();
                updatePeriodDisplay();
                loadPeriodData();
                showNotification(`ÿ™ŸÖ ÿßŸÑÿ™ÿ®ÿØŸäŸÑ ÿ•ŸÑŸâ ${financialPeriods[currentPeriodIndex].name}`, 'success');
            }
        }
        
        function prevPeriod() {
            if (currentPeriodIndex > 0) {
                currentPeriodIndex--;
                saveCurrentPeriodIndex();
                updatePeriodDisplay();
                loadPeriodData();
                showNotification(`ÿ™ŸÖ ÿßŸÑÿ™ÿ®ÿØŸäŸÑ ÿ•ŸÑŸâ ${financialPeriods[currentPeriodIndex].name}`, 'success');
            }
        }
        
        async function saveCurrentPeriodIndex() {
            try {
                await database.ref('currentPeriodIndex').set(currentPeriodIndex);
            } catch (error) {
                console.error('Error saving current period index:', error);
            }
        }
        
        function updatePeriodStats() {
            const currentPeriod = financialPeriods[currentPeriodIndex];
            
            // ÿ≠ÿ≥ÿßÿ® ÿ•ÿ≠ÿµÿßÿ¶Ÿäÿßÿ™ ÿßŸÑŸÅÿ™ÿ±ÿ©
            const periodExpenses = expenses.filter(expense => expense.periodId === currentPeriod.id);
            const periodCategories = categories;
            
            elements.periodCategoriesCount.textContent = `${periodCategories.length} ŸÅÿ¶ÿ©`;
            elements.periodExpensesCount.textContent = `${periodExpenses.length} ŸÖÿµÿ±ŸàŸÅ`;
        }

        // ÿØŸàÿßŸÑ Firebase
        async function loadData() {
            try {
                showLoading();
                
                // ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑŸÅŸáÿ±ÿ≥ ÿßŸÑÿ≠ÿßŸÑŸä ŸÑŸÑŸÅÿ™ÿ±ÿ©
                const periodIndexSnapshot = await database.ref('currentPeriodIndex').once('value');
                if (periodIndexSnapshot.exists()) {
                    currentPeriodIndex = periodIndexSnapshot.val() || 0;
                }
                
                // ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑŸÖŸäÿ≤ÿßŸÜŸäÿ©
                const budgetSnapshot = await database.ref('totalBudget').once('value');
                totalBudget = budgetSnapshot.val() || 10000;
                elements.totalBudgetInput.value = totalBudget;
                
                // ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑŸÅÿ¶ÿßÿ™ (ÿπÿßŸÖÿ© ŸÑŸÉŸÑ ÿßŸÑŸÅÿ™ÿ±ÿßÿ™)
                const categoriesSnapshot = await database.ref('categories').once('value');
                categories = [];
                if (categoriesSnapshot.val()) {
                    Object.keys(categoriesSnapshot.val()).forEach(key => {
                        categories.push({
                            id: key,
                            ...categoriesSnapshot.val()[key],
                            spent: 0
                        });
                    });
                }
                
                // ÿ™ÿ≠ŸÖŸäŸÑ ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑŸÅÿ™ÿ±ÿ© ÿßŸÑÿ≠ÿßŸÑŸäÿ©
                await loadPeriodData();
                
                // ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑŸàÿßÿ¨Ÿáÿ©
                updatePeriodDisplay();
                updateUI();
                hideLoading();
                
            } catch (error) {
                console.error('Error loading data:', error);
                showNotification('ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ŸÅŸä ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™', 'error');
                hideLoading();
            }
        }
        
        async function loadPeriodData() {
            try {
                const currentPeriod = financialPeriods[currentPeriodIndex];
                
                // ÿ™ÿ≠ŸÖŸäŸÑ ŸÖÿµÿ±ŸàŸÅÿßÿ™ ÿßŸÑŸÅÿ™ÿ±ÿ© ÿßŸÑÿ≠ÿßŸÑŸäÿ©
                const expensesSnapshot = await database.ref(`periods/${currentPeriod.id}/expenses`).once('value');
                expenses = [];
                if (expensesSnapshot.val()) {
                    Object.keys(expensesSnapshot.val()).forEach(key => {
                        expenses.push({
                            id: key,
                            ...expensesSnapshot.val()[key]
                        });
                    });
                }
                
                // ÿ™ÿ≠ÿØŸäÿ´ ÿ•ÿ≠ÿµÿßÿ¶Ÿäÿßÿ™ ÿßŸÑŸÅÿ¶ÿßÿ™
                updateCategorySpent();
                
            } catch (error) {
                console.error('Error loading period data:', error);
                showNotification('ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ŸÅŸä ÿ™ÿ≠ŸÖŸäŸÑ ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑŸÅÿ™ÿ±ÿ©', 'error');
            }
        }
        
        async function savePeriodData() {
            try {
                const currentPeriod = financialPeriods[currentPeriodIndex];
                
                // ÿ≠ŸÅÿ∏ ÿßŸÑŸÖÿµÿ±ŸàŸÅÿßÿ™ ŸÑŸÑŸÅÿ™ÿ±ÿ© ÿßŸÑÿ≠ÿßŸÑŸäÿ©
                const periodExpenses = {};
                expenses.forEach(expense => {
                    if (expense.periodId === currentPeriod.id) {
                        periodExpenses[expense.id] = expense;
                    }
                });
                
                await database.ref(`periods/${currentPeriod.id}/expenses`).set(periodExpenses);
                
                // ÿ≠ŸÅÿ∏ ÿ¢ÿÆÿ± ŸÅŸáÿ±ÿ≥ ŸÑŸÑŸÅÿ™ÿ±ÿ©
                await database.ref('currentPeriodIndex').set(currentPeriodIndex);
                
            } catch (error) {
                console.error('Error saving period data:', error);
                showNotification('ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ŸÅŸä ÿ≠ŸÅÿ∏ ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑŸÅÿ™ÿ±ÿ©', 'error');
            }
        }
        
        function updateCategorySpent() {
            const currentPeriod = financialPeriods[currentPeriodIndex];
            
            // ÿ•ÿπÿßÿØÿ© ÿ™ÿπŸäŸäŸÜ ÿßŸÑŸÖÿµÿ±ŸàŸÅÿßÿ™ ŸÑŸÑŸÅÿ¶ÿßÿ™
            categories.forEach(category => {
                category.spent = 0;
            });
            
            // ÿ≠ÿ≥ÿßÿ® ÿßŸÑŸÖÿµÿ±ŸàŸÅÿßÿ™ ŸÑŸÑŸÅÿ™ÿ±ÿ© ÿßŸÑÿ≠ÿßŸÑŸäÿ© ŸÅŸÇÿ∑
            expenses.forEach(expense => {
                if (expense.periodId === currentPeriod.id) {
                    const category = categories.find(c => c.id === expense.categoryId);
                    if (category) {
                        category.spent += expense.amount;
                    }
                }
            });
        }
        
        function updateUI() {
            updateStats();
            renderCategories();
            renderExpenses();
        }
        
        function updateStats() {
            const currentPeriod = financialPeriods[currentPeriodIndex];
            
            // ÿ•ÿ¨ŸÖÿßŸÑŸä ÿßŸÑŸÖÿµÿ±ŸàŸÅÿßÿ™ ŸÑŸÑŸÅÿ™ÿ±ÿ© ÿßŸÑÿ≠ÿßŸÑŸäÿ©
            const periodExpenses = expenses
                .filter(expense => expense.periodId === currentPeriod.id)
                .reduce((sum, expense) => sum + expense.amount, 0);
            
            elements.totalExpenses.textContent = periodExpenses.toLocaleString('ar-EG') + ' ÿ¨.ŸÖ';
            
            // ÿßŸÑŸÖŸäÿ≤ÿßŸÜŸäÿ© ÿßŸÑŸÖÿ™ÿ®ŸÇŸäÿ© (ÿπÿßŸÖÿ© ŸÑŸÉŸÑ ÿßŸÑŸÅÿ™ÿ±ÿßÿ™)
            const remaining = totalBudget - expenses.reduce((sum, e) => sum + e.amount, 0);
            elements.remainingBudget.textContent = remaining.toLocaleString('ar-EG') + ' ÿ¨.ŸÖ';
            
            // ŸÖÿµÿ±ŸàŸÅÿßÿ™ ÿßŸÑŸäŸàŸÖ (ŸÑŸÑÿ¨ŸÖŸäÿπ)
            const today = new Date().toISOString().split('T')[0];
            const todayExpenses = expenses
                .filter(expense => expense.date === today)
                .reduce((sum, expense) => sum + expense.amount, 0);
            elements.todayExpenses.textContent = todayExpenses.toLocaleString('ar-EG') + ' ÿ¨.ŸÖ';
            
            // ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿ£ÿ±ŸÇÿßŸÖ
            elements.categoriesCount.textContent = `${categories.length} ŸÅÿ¶ÿ©`;
            
            const periodExpensesCount = expenses.filter(e => e.periodId === currentPeriod.id).length;
            elements.expensesCount.textContent = `${periodExpensesCount} ŸÖÿµÿ±ŸàŸÅ`;
        }
        
        function renderCategories() {
            elements.categoriesContainer.innerHTML = '';
            
            if (categories.length === 0) {
                elements.categoriesContainer.innerHTML = `
                    <div style="grid-column: 1 / -1; text-align: center; padding: 50px; color: var(--dark-text-muted);">
                        <div style="width: 80px; height: 80px; margin: 0 auto 20px; border-radius: var(--radius-full); background: rgba(255, 255, 255, 0.05); display: flex; align-items: center; justify-content: center; font-size: 2rem; color: var(--dark-text-muted);">
                            <i class="fas fa-tags"></i>
                        </div>
                        <p style="font-weight: 800; font-size: 1.2rem; margin-bottom: 10px;">ŸÑÿß ÿ™Ÿàÿ¨ÿØ ŸÅÿ¶ÿßÿ™ ÿ®ÿπÿØ</p>
                        <p style="font-size: 0.95rem; margin-top: 5px;">ŸÇŸÖ ÿ®ÿ•ÿ∂ÿßŸÅÿ© ŸÅÿ¶ÿßÿ™ ŸÖŸÜ ŸÑŸàÿ≠ÿ© ÿßŸÑÿ™ÿ≠ŸÉŸÖ</p>
                        <button class="btn btn-outline" style="margin-top: 15px;" onclick="document.getElementById('manage-categories-btn').click()">
                            <i class="fas fa-plus"></i>
                            ÿ•ÿ∂ÿßŸÅÿ© ŸÅÿ¶ÿßÿ™
                        </button>
                    </div>
                `;
                return;
            }
            
            categories.forEach((category, index) => {
                const spent = category.spent || 0;
                const remaining = category.limit - spent;
                const percentage = Math.min((spent / category.limit) * 100, 100);
                const colorIndex = index % categoryColors.length;
                const isSelected = category.id === selectedCategoryId;
                
                const card = document.createElement('div');
                card.className = `category-card ${isSelected ? 'selected' : ''}`;
                card.dataset.categoryId = category.id;
                card.style.borderColor = isSelected ? categoryColors[colorIndex] : 'transparent';
                
                card.innerHTML = `
                    <div class="category-icon" style="background: linear-gradient(135deg, ${categoryColors[colorIndex]}, ${categoryColors[(colorIndex + 4) % categoryColors.length]})">
                        <i class="${category.icon || 'fas fa-tag'}"></i>
                    </div>
                    <div class="category-name">${category.name}</div>
                    
                    <div class="progress-container">
                        <div class="progress-info">
                            <span>${percentage.toFixed(1)}%</span>
                            <span>${spent.toLocaleString('ar-EG')} / ${category.limit.toLocaleString('ar-EG')}</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${percentage}%; background: linear-gradient(90deg, ${categoryColors[colorIndex]}, ${categoryColors[(colorIndex + 2) % categoryColors.length]})"></div>
                        </div>
                    </div>
                    
                    <div class="category-stats">
                        <span class="category-spent">${spent.toLocaleString('ar-EG')} ÿ¨.ŸÖ</span>
                        <span class="category-remaining">${remaining.toLocaleString('ar-EG')} ÿ¨.ŸÖ</span>
                    </div>
                `;
                
                card.addEventListener('click', () => selectCategory(category.id));
                card.addEventListener('dblclick', () => showCategoryDetails(category.id));
                
                elements.categoriesContainer.appendChild(card);
            });
            
            renderSelectedCategory();
        }
        
        function selectCategory(categoryId) {
            selectedCategoryId = categoryId;
            renderCategories();
            showNotification(`ÿ™ŸÖ ÿßÿÆÿ™Ÿäÿßÿ± ŸÅÿ¶ÿ© ${categories.find(c => c.id === categoryId).name}`, 'success');
        }
        
        function renderSelectedCategory() {
            if (selectedCategoryId) {
                const category = categories.find(c => c.id === selectedCategoryId);
                if (category) {
                    const spent = category.spent || 0;
                    const remaining = category.limit - spent;
                    const colorIndex = categories.findIndex(c => c.id === category.id) % categoryColors.length;
                    
                    elements.selectedCategoryIcon.style.background = `linear-gradient(135deg, ${categoryColors[colorIndex]}, ${categoryColors[(colorIndex + 4) % categoryColors.length]})`;
                    elements.selectedCategoryName.textContent = category.name;
                    elements.selectedCategoryLimit.textContent = `ÿßŸÑÿ≠ÿØ: ${category.limit.toLocaleString('ar-EG')} ÿ¨.ŸÖ | ÿßŸÑŸÖÿ™ÿ®ŸÇŸä: ${remaining.toLocaleString('ar-EG')} ÿ¨.ŸÖ`;
                    elements.categoryIdInput.value = category.id;
                    elements.selectedCategoryDisplay.style.display = 'flex';
                }
            } else {
                elements.selectedCategoryDisplay.style.display = 'none';
            }
        }
        
        function renderExpenses() {
            elements.expensesList.innerHTML = '';
            
            const currentPeriod = financialPeriods[currentPeriodIndex];
            const periodExpenses = expenses.filter(expense => expense.periodId === currentPeriod.id);
            
            if (periodExpenses.length === 0) {
                elements.expensesList.innerHTML = `
                    <div style="text-align: center; padding: 50px; color: var(--dark-text-muted);">
                        <div style="width: 80px; height: 80px; margin: 0 auto 20px; border-radius: var(--radius-full); background: rgba(255, 255, 255, 0.05); display: flex; align-items: center; justify-content: center; font-size: 2rem; color: var(--dark-text-muted);">
                            <i class="fas fa-receipt"></i>
                        </div>
                        <p style="font-weight: 800; font-size: 1.2rem; margin-bottom: 10px;">ŸÑÿß ÿ™Ÿàÿ¨ÿØ ŸÖÿµÿ±ŸàŸÅÿßÿ™ ÿ®ÿπÿØ</p>
                        <p style="font-size: 0.95rem; margin-top: 5px;">ŸÇŸÖ ÿ®ÿ•ÿ∂ÿßŸÅÿ© ŸÖÿµÿ±ŸàŸÅ ÿ¨ÿØŸäÿØ ŸÑŸÑÿ®ÿØÿ°</p>
                    </div>
                `;
                return;
            }
            
            // ÿ™ÿ¨ŸÖŸäÿπ ÿßŸÑŸÖÿµÿ±ŸàŸÅÿßÿ™ ÿ≠ÿ≥ÿ® ÿßŸÑŸÅÿ¶ÿ©
            const expensesByCategory = {};
            periodExpenses.forEach(expense => {
                if (!expensesByCategory[expense.categoryId]) {
                    expensesByCategory[expense.categoryId] = [];
                }
                expensesByCategory[expense.categoryId].push(expense);
            });
            
            // ÿπÿ±ÿ∂ ÿßŸÑŸÖÿ¨ŸÖŸàÿπÿßÿ™
            Object.keys(expensesByCategory).forEach((categoryId, index) => {
                const category = categories.find(c => c.id === categoryId);
                if (!category) return;
                
                const categoryExpenses = expensesByCategory[categoryId];
                const total = categoryExpenses.reduce((sum, exp) => sum + exp.amount, 0);
                const colorIndex = index % categoryColors.length;
                
                const group = document.createElement('div');
                group.className = 'category-group';
                group.innerHTML = `
                    <div class="group-header">
                        <div class="group-title">
                            <div class="group-icon" style="background: linear-gradient(135deg, ${categoryColors[colorIndex]}, ${categoryColors[(colorIndex + 4) % categoryColors.length]})">
                                <i class="${category.icon || 'fas fa-tag'}"></i>
                            </div>
                            <div class="group-name">${category.name}</div>
                        </div>
                        <div class="group-total">${total.toLocaleString('ar-EG')} ÿ¨.ŸÖ</div>
                    </div>
                `;
                
                const expensesContainer = document.createElement('div');
                
                // ÿ™ÿ±ÿ™Ÿäÿ® ÿßŸÑŸÖÿµÿ±ŸàŸÅÿßÿ™ ŸÖŸÜ ÿßŸÑÿ£ÿ≠ÿØÿ´
                categoryExpenses
                    .sort((a, b) => new Date(b.date) - new Date(a.date))
                    .forEach(expense => {
                        const expenseDate = new Date(expense.date);
                        const item = document.createElement('div');
                        item.className = 'expense-item';
                        item.style.borderRightColor = categoryColors[colorIndex];
                        item.innerHTML = `
                            <div class="expense-info">
                                <div class="expense-date">
                                    <i class="far fa-calendar"></i>
                                    ${expenseDate.toLocaleDateString('ar-EG')}
                                </div>
                                ${expense.notes ? `<div class="expense-notes">${expense.notes}</div>` : ''}
                            </div>
                            <div class="expense-amount">${expense.amount.toLocaleString('ar-EG')} ÿ¨.ŸÖ</div>
                            <div class="expense-actions">
                                <button class="delete-btn" data-id="${expense.id}" data-period="${currentPeriod.id}">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        `;
                        
                        expensesContainer.appendChild(item);
                    });
                
                group.appendChild(expensesContainer);
                elements.expensesList.appendChild(group);
            });
            
            // ÿ•ÿ∂ÿßŸÅÿ© ÿ£ÿ≠ÿØÿßÿ´ ÿßŸÑÿ≠ÿ∞ŸÅ
            elements.expensesList.querySelectorAll('.delete-btn').forEach(btn => {
                btn.addEventListener('click', async (e) => {
                    const expenseId = e.currentTarget.dataset.id;
                    const periodId = e.currentTarget.dataset.period;
                    await deleteExpense(expenseId, periodId);
                });
            });
        }
        
        async function addExpense(expenseData) {
            try {
                showLoading('ÿ¨ÿßÿ±Ÿä ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑŸÖÿµÿ±ŸàŸÅ...');
                elements.saveExpenseBtn.disabled = true;
                elements.saveExpenseBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> ÿ¨ÿßÿ±Ÿä ÿßŸÑÿ≠ŸÅÿ∏...';
                
                const currentPeriod = financialPeriods[currentPeriodIndex];
                
                // ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿßÿÆÿ™Ÿäÿßÿ± ÿßŸÑŸÅÿ¶ÿ©
                if (!expenseData.categoryId) {
                    showNotification('Ÿäÿ±ÿ¨Ÿâ ÿßÿÆÿ™Ÿäÿßÿ± ŸÅÿ¶ÿ© ÿ£ŸàŸÑÿßŸã', 'error');
                    elements.saveExpenseBtn.disabled = false;
                    elements.saveExpenseBtn.innerHTML = '<i class="fas fa-save"></i> ÿ≠ŸÅÿ∏ ÿßŸÑŸÖÿµÿ±ŸàŸÅ';
                    hideLoading();
                    return false;
                }
                
                // ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿßŸÑÿ≠ÿØ
                const category = categories.find(c => c.id === expenseData.categoryId);
                if (!category) throw new Error('ÿßŸÑŸÅÿ¶ÿ© ÿ∫Ÿäÿ± ŸÖŸàÿ¨ŸàÿØÿ©');
                
                const spent = category.spent || 0;
                const remaining = category.limit - spent;
                if (expenseData.amount > remaining) {
                    showNotification(`ÿ™ÿ¨ÿßŸàÿ≤ ÿßŸÑÿ≠ÿØ! ÿßŸÑŸÖÿ™ÿ®ŸÇŸä: ${remaining.toLocaleString('ar-EG')} ÿ¨.ŸÖ`, 'error');
                    elements.saveExpenseBtn.disabled = false;
                    elements.saveExpenseBtn.innerHTML = '<i class="fas fa-save"></i> ÿ≠ŸÅÿ∏ ÿßŸÑŸÖÿµÿ±ŸàŸÅ';
                    hideLoading();
                    return false;
                }
                
                // ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑŸÅÿ™ÿ±ÿ© ÿßŸÑŸÖÿßŸÑŸäÿ© ÿ•ŸÑŸâ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™
                expenseData.periodId = currentPeriod.id;
                
                // ÿ•ŸÜÿ¥ÿßÿ° ID ŸÅÿ±ŸäÿØ ŸÑŸÑŸÖÿµÿ±ŸàŸÅ
                const expenseId = database.ref().push().key;
                
                // ÿ•ÿ∂ÿßŸÅÿ© ÿ•ŸÑŸâ Firebase ÿ™ÿ≠ÿ™ ŸÖÿ≥ÿßÿ± ÿßŸÑŸÅÿ™ÿ±ÿ©
                await database.ref(`periods/${currentPeriod.id}/expenses/${expenseId}`).set(expenseData);
                
                // ÿ™ÿ≠ÿØŸäÿ´ ŸÖÿ≠ŸÑŸä
                expenses.push({
                    id: expenseId,
                    ...expenseData
                });
                
                // ÿ™ÿ≠ÿØŸäÿ´ ŸÖÿµÿ±ŸàŸÅÿßÿ™ ÿßŸÑŸÅÿ¶ÿ©
                category.spent += expenseData.amount;
                
                // ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑŸàÿßÿ¨Ÿáÿ©
                updateUI();
                elements.addExpenseForm.reset();
                setDefaultDate();
                selectedCategoryId = null;
                renderSelectedCategory();
                
                showNotification('ÿ™ŸÖ ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑŸÖÿµÿ±ŸàŸÅ ÿ®ŸÜÿ¨ÿßÿ≠', 'success');
                return true;
                
            } catch (error) {
                console.error('Error adding expense:', error);
                showNotification('ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ŸÅŸä ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑŸÖÿµÿ±ŸàŸÅ', 'error');
                return false;
            } finally {
                elements.saveExpenseBtn.disabled = false;
                elements.saveExpenseBtn.innerHTML = '<i class="fas fa-save"></i> ÿ≠ŸÅÿ∏ ÿßŸÑŸÖÿµÿ±ŸàŸÅ';
                hideLoading();
            }
        }
        
        async function deleteExpense(expenseId, periodId) {
            if (!confirm('ŸáŸÑ ÿ£ŸÜÿ™ ŸÖÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿ≠ÿ∞ŸÅ Ÿáÿ∞ÿß ÿßŸÑŸÖÿµÿ±ŸàŸÅÿü')) return;
            
            try {
                showLoading('ÿ¨ÿßÿ±Ÿä ÿ≠ÿ∞ŸÅ ÿßŸÑŸÖÿµÿ±ŸàŸÅ...');
                
                // ÿ≠ÿ∞ŸÅ ŸÖŸÜ Firebase
                await database.ref(`periods/${periodId}/expenses/${expenseId}`).remove();
                
                // ÿ™ÿ≠ÿØŸäÿ´ ŸÖÿ≠ŸÑŸä
                const deletedExpense = expenses.find(e => e.id === expenseId);
                if (deletedExpense) {
                    const category = categories.find(c => c.id === deletedExpense.categoryId);
                    if (category) {
                        category.spent -= deletedExpense.amount;
                    }
                }
                
                expenses = expenses.filter(e => e.id !== expenseId);
                
                // ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑŸàÿßÿ¨Ÿáÿ©
                updateUI();
                
                showNotification('ÿ™ŸÖ ÿ≠ÿ∞ŸÅ ÿßŸÑŸÖÿµÿ±ŸàŸÅ ÿ®ŸÜÿ¨ÿßÿ≠', 'success');
                
            } catch (error) {
                console.error('Error deleting expense:', error);
                showNotification('ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ŸÅŸä ÿ≠ÿ∞ŸÅ ÿßŸÑŸÖÿµÿ±ŸàŸÅ', 'error');
            } finally {
                hideLoading();
            }
        }
        
        async function addCategory(categoryData) {
            try {
                showLoading('ÿ¨ÿßÿ±Ÿä ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑŸÅÿ¶ÿ©...');
                
                // ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿßŸÑÿ™ŸÉÿ±ÿßÿ±
                if (categories.some(c => c.name === categoryData.name)) {
                    showNotification('ŸäŸàÿ¨ÿØ ŸÅÿ¶ÿ© ÿ®Ÿáÿ∞ÿß ÿßŸÑÿßÿ≥ŸÖ ÿ®ÿßŸÑŸÅÿπŸÑ', 'error');
                    hideLoading();
                    return false;
                }
                
                // ÿ•ÿ∂ÿßŸÅÿ© ÿ•ŸÑŸâ Firebase
                const categoryRef = await database.ref('categories').push(categoryData);
                
                // ÿ™ÿ≠ÿØŸäÿ´ ŸÖÿ≠ŸÑŸä
                categories.push({
                    id: categoryRef.key,
                    ...categoryData,
                    spent: 0,
                    icon: 'fas fa-tag'
                });
                
                // ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑŸàÿßÿ¨Ÿáÿ©
                renderCategories();
                renderCategoriesList();
                
                elements.addCategoryForm.reset();
                showNotification('ÿ™ŸÖ ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑŸÅÿ¶ÿ© ÿ®ŸÜÿ¨ÿßÿ≠', 'success');
                return true;
                
            } catch (error) {
                console.error('Error adding category:', error);
                showNotification('ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ŸÅŸä ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑŸÅÿ¶ÿ©', 'error');
                return false;
            } finally {
                hideLoading();
            }
        }
        
        async function updateCategory(categoryId, updatedData) {
            try {
                showLoading('ÿ¨ÿßÿ±Ÿä ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑŸÅÿ¶ÿ©...');
                
                // ÿ™ÿ≠ÿØŸäÿ´ ŸÅŸä Firebase
                await database.ref(`categories/${categoryId}`).update(updatedData);
                
                // ÿ™ÿ≠ÿØŸäÿ´ ŸÖÿ≠ŸÑŸä
                const index = categories.findIndex(c => c.id === categoryId);
                if (index !== -1) {
                    categories[index] = {
                        ...categories[index],
                        ...updatedData
                    };
                }
                
                // ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑŸàÿßÿ¨Ÿáÿ©
                renderCategories();
                renderCategoriesList();
                
                showNotification('ÿ™ŸÖ ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑŸÅÿ¶ÿ© ÿ®ŸÜÿ¨ÿßÿ≠', 'success');
                return true;
                
            } catch (error) {
                console.error('Error updating category:', error);
                showNotification('ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ŸÅŸä ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑŸÅÿ¶ÿ©', 'error');
                return false;
            } finally {
                hideLoading();
            }
        }
        
        async function deleteCategory(categoryId) {
            // ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ Ÿàÿ¨ŸàÿØ ŸÖÿµÿ±ŸàŸÅÿßÿ™
            const hasExpenses = expenses.some(e => e.categoryId === categoryId);
            if (hasExpenses) {
                showNotification('ŸÑÿß ŸäŸÖŸÉŸÜ ÿ≠ÿ∞ŸÅ ŸÅÿ¶ÿ© ÿ™ÿ≠ÿ™ŸàŸä ÿπŸÑŸâ ŸÖÿµÿ±ŸàŸÅÿßÿ™', 'error');
                return;
            }
            
            if (!confirm('ŸáŸÑ ÿ£ŸÜÿ™ ŸÖÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿ≠ÿ∞ŸÅ Ÿáÿ∞Ÿá ÿßŸÑŸÅÿ¶ÿ©ÿü')) return;
            
            try {
                showLoading('ÿ¨ÿßÿ±Ÿä ÿ≠ÿ∞ŸÅ ÿßŸÑŸÅÿ¶ÿ©...');
                
                // ÿ≠ÿ∞ŸÅ ŸÖŸÜ Firebase
                await database.ref(`categories/${categoryId}`).remove();
                
                // ÿ™ÿ≠ÿØŸäÿ´ ŸÖÿ≠ŸÑŸä
                categories = categories.filter(c => c.id !== categoryId);
                
                // ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑŸàÿßÿ¨Ÿáÿ©
                renderCategories();
                renderCategoriesList();
                
                showNotification('ÿ™ŸÖ ÿ≠ÿ∞ŸÅ ÿßŸÑŸÅÿ¶ÿ© ÿ®ŸÜÿ¨ÿßÿ≠', 'success');
                
            } catch (error) {
                console.error('Error deleting category:', error);
                showNotification('ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ŸÅŸä ÿ≠ÿ∞ŸÅ ÿßŸÑŸÅÿ¶ÿ©', 'error');
            } finally {
                hideLoading();
            }
        }
        
        async function updateBudget(newBudget) {
            try {
                showLoading('ÿ¨ÿßÿ±Ÿä ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑŸÖŸäÿ≤ÿßŸÜŸäÿ©...');
                
                // ÿ™ÿ≠ÿØŸäÿ´ Firebase
                await database.ref('totalBudget').set(newBudget);
                
                // ÿ™ÿ≠ÿØŸäÿ´ ŸÖÿ≠ŸÑŸä
                totalBudget = newBudget;
                
                // ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑŸàÿßÿ¨Ÿáÿ©
                updateStats();
                
                showNotification('ÿ™ŸÖ ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑŸÖŸäÿ≤ÿßŸÜŸäÿ© ÿ®ŸÜÿ¨ÿßÿ≠', 'success');
                return true;
                
            } catch (error) {
                console.error('Error updating budget:', error);
                showNotification('ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ŸÅŸä ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑŸÖŸäÿ≤ÿßŸÜŸäÿ©', 'error');
                return false;
            } finally {
                hideLoading();
            }
        }
        
        function renderCategoriesList() {
            const container = document.getElementById('categories-list');
            if (!container) return;
            
            container.innerHTML = '';
            
            if (categories.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 25px; color: var(--dark-text-muted);">
                        <p style="font-size: 1rem;">ŸÑÿß ÿ™Ÿàÿ¨ÿØ ŸÅÿ¶ÿßÿ™</p>
                    </div>
                `;
                return;
            }
            
            categories.forEach((category, index) => {
                const spent = category.spent || 0;
                const remaining = category.limit - spent;
                const percentage = (spent / category.limit) * 100;
                const colorIndex = index % categoryColors.length;
                
                const item = document.createElement('div');
                item.className = 'expense-item';
                item.style.marginBottom = '12px';
                item.style.borderRightColor = categoryColors[colorIndex];
                item.innerHTML = `
                    <div class="expense-info">
                        <div class="expense-date">
                            <i class="fas fa-tag" style="color: ${categoryColors[colorIndex]}"></i>
                            <span style="font-weight: 800; font-size: 1.1rem;">${category.name}</span>
                        </div>
                        <div class="expense-notes" style="font-size: 0.9rem; color: var(--dark-text-secondary);">
                            ÿßŸÑÿ≠ÿØ: ${category.limit.toLocaleString('ar-EG')} ÿ¨.ŸÖ | ÿßŸÑŸÖÿµÿ±ŸàŸÅ: ${spent.toLocaleString('ar-EG')} ÿ¨.ŸÖ | ÿßŸÑŸÖÿ™ÿ®ŸÇŸä: ${remaining.toLocaleString('ar-EG')} ÿ¨.ŸÖ
                        </div>
                    </div>
                    <div class="expense-actions">
                        <button class="edit-btn" data-category-id="${category.id}">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="delete-btn" data-category-id="${category.id}">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                `;
                
                container.appendChild(item);
            });
            
            // ÿ£ÿ≠ÿØÿßÿ´ ÿßŸÑÿ≠ÿ∞ŸÅ ŸàÿßŸÑÿ™ÿπÿØŸäŸÑ
            container.querySelectorAll('.delete-btn').forEach(btn => {
                btn.addEventListener('click', async (e) => {
                    const categoryId = e.currentTarget.dataset.categoryId;
                    await deleteCategory(categoryId);
                });
            });
            
            container.querySelectorAll('.edit-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const categoryId = e.currentTarget.dataset.categoryId;
                    openEditCategoryModal(categoryId);
                });
            });
        }
        
        function openEditCategoryModal(categoryId) {
            const category = categories.find(c => c.id === categoryId);
            if (!category) return;
            
            document.getElementById('edit-category-id').value = category.id;
            document.getElementById('edit-category-name').value = category.name;
            document.getElementById('edit-category-limit').value = category.limit;
            
            elements.categoriesModal.classList.remove('active');
            setTimeout(() => {
                elements.editCategoryModal.classList.add('active');
            }, 300);
        }
        
        function renderAllExpenses() {
            const container = document.getElementById('all-expenses-list');
            if (!container) return;
            
            container.innerHTML = '';
            
            if (expenses.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 30px; color: var(--dark-text-muted);">
                        <p style="font-size: 1rem;">ŸÑÿß ÿ™Ÿàÿ¨ÿØ ŸÖÿµÿ±ŸàŸÅÿßÿ™</p>
                    </div>
                `;
                return;
            }
            
            // ÿ™ÿ±ÿ™Ÿäÿ® ÿßŸÑŸÖÿµÿ±ŸàŸÅÿßÿ™ ŸÖŸÜ ÿßŸÑÿ£ÿ≠ÿØÿ´
            const sortedExpenses = [...expenses].sort((a, b) => new Date(b.date) - new Date(a.date));
            
            sortedExpenses.forEach(expense => {
                const category = categories.find(c => c.id === expense.categoryId);
                const period = financialPeriods.find(p => p.id === expense.periodId);
                const expenseDate = new Date(expense.date);
                const colorIndex = categories.findIndex(c => c.id === expense.categoryId) % categoryColors.length;
                
                const item = document.createElement('div');
                item.className = 'expense-item';
                item.style.marginBottom = '10px';
                item.style.borderRightColor = categoryColors[colorIndex];
                item.innerHTML = `
                    <div class="expense-info">
                        <div class="expense-date">
                            <i class="far fa-calendar"></i>
                            ${expenseDate.toLocaleDateString('ar-EG')}
                            <span style="margin-right: 10px; color: ${categoryColors[colorIndex]}; font-weight: 800; font-size: 1rem;">
                                ${category ? category.name : 'ÿ∫Ÿäÿ± ŸÖÿπÿ±ŸàŸÅ'}
                            </span>
                            ${period ? `<span style="color: var(--dark-text-secondary); font-size: 0.9rem;">${period.name}</span>` : ''}
                        </div>
                        ${expense.notes ? `<div class="expense-notes" style="font-size: 0.95rem;">${expense.notes}</div>` : ''}
                    </div>
                    <div class="expense-amount">${expense.amount.toLocaleString('ar-EG')} ÿ¨.ŸÖ</div>
                `;
                
                container.appendChild(item);
            });
        }
        
        function showCategoryDetails(categoryId) {
            const category = categories.find(c => c.id === categoryId);
            if (!category) return;
            
            const spent = category.spent || 0;
            const remaining = category.limit - spent;
            const percentage = (spent / category.limit) * 100;
            
            alert(`üìä ÿ™ŸÅÿßÿµŸäŸÑ ÿßŸÑŸÅÿ¶ÿ©: ${category.name}\n\nüí∞ ÿßŸÑÿ≠ÿØ ÿßŸÑÿ¥Ÿáÿ±Ÿä: ${category.limit.toLocaleString('ar-EG')} ÿ¨.ŸÖ\nüí∏ ÿßŸÑŸÖÿµÿ±ŸàŸÅ: ${spent.toLocaleString('ar-EG')} ÿ¨.ŸÖ\n‚úÖ ÿßŸÑŸÖÿ™ÿ®ŸÇŸä: ${remaining.toLocaleString('ar-EG')} ÿ¨.ŸÖ\nüìà ŸÜÿ≥ÿ®ÿ© ÿßŸÑÿßÿ≥ÿ™ÿÆÿØÿßŸÖ: ${percentage.toFixed(1)}%\n\n${percentage >= 90 ? '‚ö†Ô∏è ÿ™ŸÜÿ®ŸäŸá: ÿßŸÇÿ™ÿ±ÿ®ÿ™ ŸÖŸÜ ÿ™ÿ¨ÿßŸàÿ≤ ÿßŸÑÿ≠ÿØ!' : percentage >= 75 ? '‚ÑπÔ∏è ŸÖŸÑÿßÿ≠ÿ∏ÿ©: ÿ™ÿ¨ÿßŸàÿ≤ÿ™ 75% ŸÖŸÜ ÿßŸÑÿ≠ÿØ' : '‚úÖ ÿ¨ŸäÿØ: ÿ∂ŸÖŸÜ ÿßŸÑÿ≠ÿØ ÿßŸÑŸÖÿ≥ŸÖŸàÿ≠'}`);
        }

        // ÿ•ÿπÿØÿßÿØ ÿßŸÑÿ£ÿ≠ÿØÿßÿ´
        function setupEventListeners() {
            // ÿßŸÑÿ™ŸÜŸÇŸÑ ÿ®ŸäŸÜ ÿßŸÑŸÅÿ™ÿ±ÿßÿ™
            elements.prevPeriodBtn.addEventListener('click', prevPeriod);
            elements.nextPeriodBtn.addEventListener('click', nextPeriod);
            
            // ÿ•ÿ∂ÿßŸÅÿ© ŸÖÿµÿ±ŸàŸÅ
            elements.addExpenseForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                
                if (!selectedCategoryId) {
                    showNotification('Ÿäÿ±ÿ¨Ÿâ ÿßÿÆÿ™Ÿäÿßÿ± ŸÅÿ¶ÿ© ÿ£ŸàŸÑÿßŸã', 'error');
                    return;
                }
                
                const amount = parseFloat(document.getElementById('amount').value);
                if (amount <= 0) {
                    showNotification('Ÿäÿ±ÿ¨Ÿâ ÿ•ÿØÿÆÿßŸÑ ŸÖÿ®ŸÑÿ∫ ÿµÿ≠Ÿäÿ≠', 'error');
                    return;
                }
                
                const expenseData = {
                    categoryId: selectedCategoryId,
                    amount: amount,
                    date: document.getElementById('expense-date').value,
                    notes: document.getElementById('notes').value,
                    createdAt: new Date().toISOString()
                };
                
                await addExpense(expenseData);
            });
            
            // ÿ™ÿ∫ŸäŸäÿ± ÿßŸÑŸÅÿ¶ÿ©
            elements.changeCategoryBtn.addEventListener('click', () => {
                selectedCategoryId = null;
                renderSelectedCategory();
                renderCategories();
                showNotification('ÿ™ŸÖ ÿ•ŸÑÿ∫ÿßÿ° ÿßÿÆÿ™Ÿäÿßÿ± ÿßŸÑŸÅÿ¶ÿ©', 'success');
            });
            
            // ŸÑŸàÿ≠ÿ© ÿßŸÑÿ™ÿ≠ŸÉŸÖ
            elements.adminBtn.addEventListener('click', () => {
                elements.adminModal.classList.add('active');
            });
            
            elements.closeAdminModal.addEventListener('click', () => {
                elements.adminModal.classList.remove('active');
            });
            
            // ÿ•ÿØÿßÿ±ÿ© ÿßŸÑŸÅÿ¶ÿßÿ™
            elements.manageCategoriesBtn.addEventListener('click', () => {
                elements.adminModal.classList.remove('active');
                setTimeout(() => {
                    renderCategoriesList();
                    elements.categoriesModal.classList.add('active');
                }, 300);
            });
            
            elements.closeCategoriesModal.addEventListener('click', () => {
                elements.categoriesModal.classList.remove('active');
            });
            
            // ÿ™ÿπÿØŸäŸÑ ÿßŸÑŸÅÿ¶ÿ©
            elements.closeEditCategoryModal.addEventListener('click', () => {
                elements.editCategoryModal.classList.remove('active');
            });
            
            elements.editCategoryForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                
                const categoryId = document.getElementById('edit-category-id').value;
                const name = document.getElementById('edit-category-name').value.trim();
                const limit = parseFloat(document.getElementById('edit-category-limit').value);
                
                if (!name) {
                    showNotification('Ÿäÿ±ÿ¨Ÿâ ÿ•ÿØÿÆÿßŸÑ ÿßÿ≥ŸÖ ÿßŸÑŸÅÿ¶ÿ©', 'error');
                    return;
                }
                
                if (limit <= 0) {
                    showNotification('Ÿäÿ±ÿ¨Ÿâ ÿ•ÿØÿÆÿßŸÑ ÿ≠ÿØ ÿ¥Ÿáÿ±Ÿä ÿµÿ≠Ÿäÿ≠', 'error');
                    return;
                }
                
                const updatedData = {
                    name: name,
                    limit: limit
                };
                
                await updateCategory(categoryId, updatedData);
                elements.editCategoryModal.classList.remove('active');
            });
            
            // ÿ•ÿ∂ÿßŸÅÿ© ŸÅÿ¶ÿ©
            elements.addCategoryForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                
                const name = document.getElementById('new-category-name').value.trim();
                const limit = parseFloat(document.getElementById('new-category-limit').value);
                
                if (!name) {
                    showNotification('Ÿäÿ±ÿ¨Ÿâ ÿ•ÿØÿÆÿßŸÑ ÿßÿ≥ŸÖ ÿßŸÑŸÅÿ¶ÿ©', 'error');
                    return;
                }
                
                if (limit <= 0) {
                    showNotification('Ÿäÿ±ÿ¨Ÿâ ÿ•ÿØÿÆÿßŸÑ ÿ≠ÿØ ÿ¥Ÿáÿ±Ÿä ÿµÿ≠Ÿäÿ≠', 'error');
                    return;
                }
                
                const categoryData = {
                    name: name,
                    limit: limit,
                    createdAt: new Date().toISOString()
                };
                
                await addCategory(categoryData);
            });
            
            // ÿ™ÿπÿØŸäŸÑ ÿßŸÑŸÖŸäÿ≤ÿßŸÜŸäÿ©
            elements.setBudgetBtn.addEventListener('click', () => {
                elements.adminModal.classList.remove('active');
                setTimeout(() => {
                    elements.budgetModal.classList.add('active');
                }, 300);
            });
            
            elements.closeBudgetModal.addEventListener('click', () => {
                elements.budgetModal.classList.remove('active');
            });
            
            elements.saveBudgetBtn.addEventListener('click', async () => {
                const newBudget = parseFloat(elements.totalBudgetInput.value);
                if (newBudget > 0) {
                    await updateBudget(newBudget);
                    elements.budgetModal.classList.remove('active');
                } else {
                    showNotification('Ÿäÿ±ÿ¨Ÿâ ÿ•ÿØÿÆÿßŸÑ ŸÇŸäŸÖÿ© ÿµÿ≠Ÿäÿ≠ÿ©', 'error');
                }
            });
            
            // ÿ¨ŸÖŸäÿπ ÿßŸÑŸÖÿµÿ±ŸàŸÅÿßÿ™
            elements.viewAllExpensesBtn.addEventListener('click', () => {
                elements.adminModal.classList.remove('active');
                setTimeout(() => {
                    renderAllExpenses();
                    elements.allExpensesModal.classList.add('active');
                }, 300);
            });
            
            elements.closeAllExpensesModal.addEventListener('click', () => {
                elements.allExpensesModal.classList.remove('active');
            });
            
            // ÿ™ÿµÿØŸäÿ± ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™
            elements.exportDataBtn.addEventListener('click', () => {
                const currentPeriod = financialPeriods[currentPeriodIndex];
                const periodExpenses = expenses.filter(expense => expense.periodId === currentPeriod.id);
                
                const data = {
                    period: currentPeriod,
                    categories: categories,
                    expenses: periodExpenses,
                    totalBudget: totalBudget,
                    exportDate: new Date().toISOString(),
                    summary: {
                        totalExpenses: periodExpenses.reduce((sum, e) => sum + e.amount, 0),
                        remainingBudget: totalBudget - periodExpenses.reduce((sum, e) => sum + e.amount, 0),
                        categoriesCount: categories.length,
                        expensesCount: periodExpenses.length
                    }
                };
                
                const dataStr = JSON.stringify(data, null, 2);
                const dataUri = 'data:application/json;charset=utf-8,' + encodeURIComponent(dataStr);
                const periodName = currentPeriod.name.replace(/\s+/g, '_');
                const exportName = `ŸÖÿµÿßÿ±ŸäŸÅ_${periodName}_${new Date().toISOString().split('T')[0]}.json`;
                
                const link = document.createElement('a');
                link.href = dataUri;
                link.download = exportName;
                link.click();
                
                showNotification('ÿ™ŸÖ ÿ™ÿµÿØŸäÿ± ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿ®ŸÜÿ¨ÿßÿ≠', 'success');
                elements.adminModal.classList.remove('active');
            });
            
            // ÿ•ÿπÿßÿØÿ© ÿßŸÑÿ∂ÿ®ÿ∑
            elements.resetDataBtn.addEventListener('click', async () => {
                if (!confirm('‚ö†Ô∏è ŸáŸÑ ÿ£ŸÜÿ™ ŸÖÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿ•ÿπÿßÿØÿ© ÿ∂ÿ®ÿ∑ ÿ¨ŸÖŸäÿπ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ÿü Ÿáÿ∞ÿß ÿßŸÑÿ•ÿ¨ÿ±ÿßÿ° ŸÑÿß ŸäŸÖŸÉŸÜ ÿßŸÑÿ™ÿ±ÿßÿ¨ÿπ ÿπŸÜŸá!')) return;
                
                try {
                    showLoading('ÿ¨ÿßÿ±Ÿä ÿ•ÿπÿßÿØÿ© ÿßŸÑÿ∂ÿ®ÿ∑...');
                    
                    // ÿ≠ÿ∞ŸÅ ÿ¨ŸÖŸäÿπ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ŸÖŸÜ Firebase
                    await database.ref('expenses').remove();
                    await database.ref('categories').remove();
                    await database.ref('periods').remove();
                    await database.ref('totalBudget').set(10000);
                    await database.ref('currentPeriodIndex').set(0);
                    
                    // ÿ™ÿ≠ÿØŸäÿ´ ŸÖÿ≠ŸÑŸä
                    categories = [];
                    expenses = [];
                    totalBudget = 10000;
                    currentPeriodIndex = 0;
                    selectedCategoryId = null;
                    
                    // ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑŸàÿßÿ¨Ÿáÿ©
                    updatePeriodDisplay();
                    updateUI();
                    renderCategoriesList();
                    
                    showNotification('ÿ™ŸÖÿ™ ÿ•ÿπÿßÿØÿ© ÿ∂ÿ®ÿ∑ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿ®ŸÜÿ¨ÿßÿ≠', 'success');
                    elements.adminModal.classList.remove('active');
                    
                } catch (error) {
                    console.error('Error resetting data:', error);
                    showNotification('ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ŸÅŸä ÿ•ÿπÿßÿØÿ© ÿßŸÑÿ∂ÿ®ÿ∑', 'error');
                } finally {
                    hideLoading();
                }
            });
            
            // ÿßŸÑÿ®ÿ≠ÿ´ ŸÅŸä ÿßŸÑŸÖÿµÿ±ŸàŸÅÿßÿ™
            elements.searchExpenses.addEventListener('input', () => {
                const searchTerm = elements.searchExpenses.value.toLowerCase();
                const items = document.querySelectorAll('#all-expenses-list .expense-item');
                
                items.forEach(item => {
                    const text = item.textContent.toLowerCase();
                    item.style.display = text.includes(searchTerm) ? 'flex' : 'none';
                });
            });
            
            // ÿ•ÿ∫ŸÑÿßŸÇ ÿßŸÑŸÖŸàÿØŸäŸàŸÑÿßÿ™ ÿ®ÿßŸÑŸÜŸÇÿ± ÿÆÿßÿ±ÿ¨Ÿáÿß
            document.querySelectorAll('.modal').forEach(modal => {
                modal.addEventListener('click', (e) => {
                    if (e.target === modal) {
                        modal.classList.remove('active');
                    }
                });
            });
            
            // ÿ≤ÿ± ESC ŸÑÿ•ÿ∫ŸÑÿßŸÇ ÿßŸÑŸÖŸàÿØŸäŸàŸÑÿßÿ™
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') {
                    document.querySelectorAll('.modal.active').forEach(modal => {
                        modal.classList.remove('active');
                    });
                }
                
                // ŸÖŸÅÿßÿ™Ÿäÿ≠ ÿßŸÑÿ™ŸÜŸÇŸÑ ÿ®ŸäŸÜ ÿßŸÑŸÅÿ™ÿ±ÿßÿ™
                if (e.key === 'ArrowRight' && !e.ctrlKey && !e.altKey) {
                    e.preventDefault();
                    prevPeriod();
                }
                
                if (e.key === 'ArrowLeft' && !e.ctrlKey && !e.altKey) {
                    e.preventDefault();
                    nextPeriod();
                }
            });
        }
        
        // ÿ™ŸáŸäÿ¶ÿ© ÿßŸÑÿ™ÿ∑ÿ®ŸäŸÇ
        async function initApp() {
            createParticles();
            setDefaultDate();
            setupEventListeners();
            
            try {
                showLoading();
                await loadData();
                hideLoading();
                
                // ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑŸÖÿ§ÿ´ÿ±ÿßÿ™ ÿ®ÿπÿØ ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™
                setTimeout(() => {
                    showNotification('ŸÖÿ±ÿ≠ÿ®ÿßŸã ÿ®ŸÉ ŸÅŸä ÿ™ÿ∑ÿ®ŸäŸÇ ÿ•ÿØÿßÿ±ÿ© ÿßŸÑŸÖÿµÿ±ŸàŸÅÿßÿ™ ÿßŸÑÿ∞ŸÉŸäÿ©! üëã', 'success');
                }, 1000);
                
            } catch (error) {
                console.error('Error initializing app:', error);
                showNotification('ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ŸÅŸä ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ™ÿ∑ÿ®ŸäŸÇ', 'error');
                hideLoading();
            }
        }
        
        // ÿ®ÿØÿ° ÿßŸÑÿ™ÿ∑ÿ®ŸäŸÇ
        document.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>
